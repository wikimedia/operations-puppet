#!/bin/bash

PATH=/bin:/usr/bin:/sbin:/usr/sbin:
TERM=dumb

. /usr/local/lib/mw-deployment-vars.sh

SERVER="$1"
if [ -z "$SERVER" ]; then
	SERVER="${MW_RSYNC_HOST}"
fi

echo -n Copying to `hostname -s` from "$SERVER"...
if rsync "${MW_RSYNC_ARGS[@]}" "$SERVER"::common/ "${MW_COMMON}"
then
	echo "ok"
else
	echo "failed"
	exit 1
fi

# Leave some of the cores free for apache processes
CPUS=`grep -c 'model name' /proc/cpuinfo`
THREADS=`expr $CPUS / 2`

# Rebuild the CDB files from the JSON versions
#/usr/local/bin/mergeCdbFileUpdates --directory="$MW_COMMON/php-$mwVerNum/cache/l10n" \
#	--threads=$THREADS \
#	|| die
