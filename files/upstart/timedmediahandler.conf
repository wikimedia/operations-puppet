# TimedMediaHandler WebVideoJobRunner

description     "TimedMediaHandler WebVideoJobRunner"

start on runlevel [2345]
stop on runlevel [!2345]
kill timeout 5
respawn
respawn limit 10 5

umask 022

env MW_INSTALL_PATH=/usr/local/apache/common/docroot/commons/w
env TMP=/mnt/data/tmp
env USER=www-data
script
test -e $TMP || (mkdir -p $TMP && chown $USER:$USER $TMP)
exec /usr/bin/sudo -u $USER TMP=$TMP MW_INSTALL_PATH=$MW_INSTALL_PATH /usr/bin/php $MW_INSTALL_PATH/extensions/TimedMediaHandler/maintenance/WebVideoJobRunner.php --wiki commonswiki >/dev/null 2>&1
end script
