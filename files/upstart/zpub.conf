# zpub - Varnishlog ZeroMQ publisher
# This file is managed by Puppet!

description "Varnishlog ZeroMQ publisher"
author "Ori Livneh <ori@wikimedia.org>"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

respawn
respawn limit 10 5

setuid www-data
script
	zpub_port="8006"
	exec bash -c "( /usr/bin/varnishncsa -m RxURL:^/event\.gif -F '%q' | /usr/bin/zpub -p ${zpub_port} )"
end script
