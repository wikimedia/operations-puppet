#######################################################################
## WARNING: this file is managed by Puppet
## puppet:///files/upstart/wmf-lucene-incupdate
########################################################################

description "Incremental update for Wikimedia lucene indices"

author "Antoine Musso <hashar@free.fr>"

setuid lsearch

# start/stop based on ssh
start on filesystem or runlevel [2345]
stop on runlevel [!2345]

# Log to /var/log/upstart
console log

pre-start script
	# Better have the wrapping shell script
	test -x /a/search/lucene.jobs.sh || { stop; exit 0; }
end script

script
	# Load default environnement
	if [ -f "$DEFAULTFILE" ]; then
	. "$DEFAULTFILE"
	fi

	exec /usr/bin/env /a/search/lucene.jobs.sh  inc-updater-start
end script
