filter {
  if [type] == "gelf" {
    if [facility] == "Hadoop" {
      mutate {
        replace => [ "channel", "%{_SourceSimpleClassName}" ]
        replace => [ "Severity", "%{_Severity}" ]
        replace => [ "ClassName", "%{_SourceClassName}" ]
        replace => [ "MethodName", "%{_SourceMethodName}" ]
        replace => [ "Thread", "%{_Thread}" ]
        replace => [ "LoggerName", "%{_LoggerName}" ]
      }
    }
    mutate {
      # tag gelf messages for storage in elasticsearch
      add_tag => [ "es", "gelf" ]
    }
    mutate {
      # move field names to what we're expecting
      replace => [ "type", "%{facility}" ]
      replace => [ "message", "%{short_message}" ]
    }
    mutate {
      # get rid of fields we moved
      remove_field => [ "facility", "short_message" ]
    }
    prune {
      # get rid of a whole bunch of useless _ fields that are duplicated
      # We must keep _id, _index, and _type
      blacklist_names => [ "^_(?!id$|index$|type$).*" ]
    }
  }
}
