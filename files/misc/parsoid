#! /bin/bash

#####################################################################
### THIS FILE IS MANAGED BY PUPPET
### puppet:///files/misc/parsoid
#####################################################################

# Script to start Parsoid

(
	cd /var/lib/parsoid/VisualEditor/modules/parser
	export NODE_PATH=/var/lib/parsoid/VisualEditor/modules/parser/node_modules
	sudo -E -u parsoid nohup node /var/lib/parsoid/VisualEditor/api/server.js > /var/lib/parsoid/nohup.out 2>&1 &
	PARSOIDPID=$!
	echo $PARSOIDPID > /var/run/parsoid.pid
	wait $PARSOIDPID
	rm /var/run/parsoid.pid
) &
