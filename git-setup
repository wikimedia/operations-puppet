#!/bin/bash

# Basic setup for the puppet git repository

# Need this info
echo "Type your Labs console wiki username:"
read name
echo "Type the e-mail address for this username:"
read email

# Global config
git config --global user.email "$email"
git config --global user.name "$name"

# Setup remotes/aliases
git remote add puppet ssh://$name@gerrit.wikimedia.org:29418/operations/puppet
git config alias.push-for-review-test "push puppet HEAD:refs/for/test"
git config alias.push-for-review-production "push puppet HEAD:refs/for/production"

which curl
if [ "$?" == "0" ]
then
	curl "https://gerrit.wikimedia.org/r/tools/hooks/commit-msg" > .git/hooks/commit-msg && chmod u+x .git/hooks/commit-msg
else
	which wget
	if [ "$?" == "0" ]
	then
		wget "https://gerrit.wikimedia.org/r/tools/hooks/commit-msg" -O .git/hooks/commit-msg && chmod u+x .git/hooks/commit-msg
	else
		echo "Please download the commit message hook from https://gerrit.wikimedia.org/r/tools/hooks/commit-msg, place it in .git/hooks/commit-msg, and chmod u+x the file."
	fi
fi
