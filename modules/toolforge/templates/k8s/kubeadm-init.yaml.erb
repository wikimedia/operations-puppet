<% if @node_token %>
apiVersion: kubeadm.k8s.io/v1beta2
kind: InitConfiguration
bootstrapTokens:
- token: "<%= @node_token -%>"
  description: "Node Token"
  usages:
    - authentication
    - signing
  groups:
    - system:bootstrappers:kubeadm:default-node-token
localAPIEndpoint:
  bindPort: 6443
---
<% end %>
apiVersion: kubeadm.k8s.io/v1beta2
kind: ClusterConfiguration
networking:
  podSubnet: "<%= @pod_subnet -%>"
  dnsDomain: <%= @labsproject -%>.local
kubernetesVersion: "<%= @kubernetes_version -%>"
controlPlaneEndpoint: "<%= @apiserver -%>:6443"
clusterName: "<%= @labsproject -%>"
apiServer:
  extraArgs:
    enable-admission-plugins: PodSecurityPolicy
etcd:
  external:
    caFile: "<%= @k8s_etcd_cert_ca -%>"
    certFile: "<%= @k8s_etcd_cert_pub -%>"
    keyFile: "<%= @k8s_etcd_cert_priv -%>"
    endpoints:
    <% @etcd_hosts.each do |host| -%>
      - "https://<%= host -%>:2379"
    <% end -%>

