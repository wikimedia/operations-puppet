# This file is managed by Puppet.
# See modules/external_proxy/templates/instance.conf.erb
server {
    listen <%= @port %><% if @default %> default_server<% end %>;
    listen [::]:<%= @port %><% if @default %> default_server<% end %>;
    server_name <%= @title %>;

    location / {
        # Access control
        <% @acls.each do |acl| -%>
        <%= acl %>
        <% end -%>

        # Act as a reverse proxy to <%= @proxied %>
        proxy_http_version 1.1;
        proxy_pass <%= @proxied %>;
        # Rewrite Location headers in proxied responses
        proxy_redirect <%= @proxied %>/ /;
        # Rewrite Set-Cookie headers in proxied responses
        proxy_cookie_domain <%= @proxied %> $host;

    }
}
