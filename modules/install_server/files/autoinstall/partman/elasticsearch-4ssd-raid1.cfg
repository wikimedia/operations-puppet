# Automatic software RAID partitioning
#
# * four disks, sda, sdb, sdc, sdd
# * primary partitions, no LVM
# * layout:
#   - /   : ext3, RAID1, 30GB
#   - swap: RAID1, 1GB
#   - /var/lib/elasticsearch: ext4, RAID1
#

d-i	partman-auto/method		string	raid
d-i	partman-basicmethods/method_only	boolean	false
d-i	partman-md/device_remove_md	boolean	true
d-i	partman-lvm/device_remove_lvm	boolean	true

# Use the first two disks
d-i	partman-auto/disk	string	/dev/sda /dev/sdb /dev/sdc /dev/sdd

# Define physical partitions
d-i	partman-auto/expert_recipe	string		\
		multiraid ::						\
			5000	8000	30000	raid	\
				$primary{ } method{ raid }	\
			.								\
			1000	1000	1000	raid	\
				$primary{ } method{ raid }	\
			.								\
			1000	1000	-1	raid		\
				$primary{ } method{ keep }	\
			.

# Parameters are:
# <raidtype> <devcount> <sparecount> <fstype> <mountpoint> \
#	<devices> <sparedevices>
d-i	partman-auto-raid/recipe	string				\
		1	4	0	ext3	/						\
			/dev/sda1#/dev/sdb1#/dev/sdc1#/dev/sdd1	\
		.											\
		1	4	0	swap	-						\
			/dev/sda2#/dev/sdb2#/dev/sdc2#/dev/sdd2	\
		.											\
		1	4	0	ext4	/var/lib/elasticsearch	\
			/dev/sda3#/dev/sdb3#/dev/sdc3#/dev/sdd3	\
		.

d-i	partman-md/confirm		boolean	true
d-i	partman-md/confirm_nooverwrite 	boolean	true
d-i	partman/confirm_write_new_label	boolean	true
d-i	partman/choose_partition	select	finish
d-i	partman/confirm			boolean	true
d-i	partman/confirm_nooverwrite 	boolean	true
