#####################################################################
### THIS FILE IS MANAGED BY PUPPET
#####################################################################

from sentry.conf.server import *

import os.path

CONF_ROOT = os.path.dirname(__file__)

################
##  Database  ##
################

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql_psycopg2',
        'NAME': '<%= @db_name %>',
        'USER': '<%= @db_user %>',
        'PASSWORD': '<%= @db_pass %>',
    }
}

####################
## Authentication ##
####################

# TODO don't allow random signups - T97133
# SENTRY_FEATURES['auth:register'] = False

################
## Web Server ##
################

SENTRY_URL_PREFIX = 'https://<%= @host_name %>'

SENTRY_WEB_HOST = '0.0.0.0'
SENTRY_WEB_PORT = 9000
SENTRY_WEB_OPTIONS = {
    'workers': 3,  # the number of gunicorn workers
    'limit_request_line': 0,  # required for raven-js
}

SENTRY_ALLOW_ORIGIN = '*'

# Enable logging via HTTPS through the Nginx gateway
SECURE_PROXY_SSL_HEADER = ('HTTP_X_FORWARDED_PROTO', 'https')
USE_X_FORWARDED_HOST = True
SENTRY_WEB_OPTIONS['secure_scheme_headers'] = {'X-FORWARDED-PROTO': 'https'}

SENTRY_CACHE = 'sentry.cache.django.DjangoCache'

#################
## Mail Server ##
#################

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'
EMAIL_HOST = '<%= @smtp_host %>'
EMAIL_HOST_USER = '<%= @smtp_user %>'
EMAIL_HOST_PASSWORD = '<%= @smtp_pass %>'
SERVER_EMAIL = 'sentry@<%= @host_name %>'

# see http://sentry.readthedocs.org/en/latest/beacon.html
SENTRY_ADMIN_EMAIL = <%= @admin_email %>

##########
## etc. ##
##########

SECRET_KEY = '<%= @secret_key %>'

# don't allow non-superusers to make projects globally public
SENTRY_ALLOW_PUBLIC_PROJECTS = False

