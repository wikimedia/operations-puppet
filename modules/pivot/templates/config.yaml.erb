# generated by Pivot version 0.9.39
# for a more detailed walk-through go to: https://github.com/implydata/pivot/blob/v0.9.39/docs/configuration.md

# The port on which the Pivot server will listen on
port: <%= @port %>

clusters:
  - name: druid

    # The database type of the cluster
    type: druid

    # The host (hostname:port) of the cluster. In the Druid case this must be the broker.
    host: <%= @druid_broker %>

    # The timeout to set on the queries in ms.
    timeout: <%= @query_timeout %>

    # Should the sources of this cluster be automatically scanned and new sources added as data cubes.
    sourceListScan: auto

    # Should the list of sources be reloaded every time that Pivot is loaded.
    #sourceListRefreshOnLoad: false

    # How often should sources be reloaded in ms.
    sourceListRefreshInterval: <%= @source_refresh_ms %>

    # Should sources be scanned for additional dimensions every time that Pivot is loaded.
    #sourceReintrospectOnLoad: false

    # How often should source schema be reloaded in ms.
    sourceReintrospectInterval: <%= @schema_refresh_ms %>

    # Database specific (druid) ===============

    # The introspection strategy for the Druid external.
    #introspectionStrategy: segment-metadata-fallback

dataCubes:
  - name: pageviews-daily
    title: Pageviews Daily
    description: Small dataset - Starting July 2015 - Daily resolution - Monthly loading
    clusterName: druid
    source: pageviews-daily
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC

    #defaultDuration: P1D

    #defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    #
    # Disabling introspection as it fails to get all dimensions and measures
    introspection: none

    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: access_method
        title: Access Method
        formula: $access_method

      - name: agent_type
        title: Agent Type
        formula: $agent_type

      - name: continent
        title: Continent
        formula: $continent

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: language_variant
        title: Language Variant
        formula: $language_variant

      - name: project
        title: Project
        formula: $project

      - name: referer_class
        title: Referer Class
        formula: $referer_class

      - name: ua_browser_family
        title: Ua Browser Family
        formula: $ua_browser_family

      - name: ua_browser_major
        title: Ua Browser Major
        formula: $ua_browser_major

      - name: ua_os_family
        title: Ua Os Family
        formula: $ua_os_family

      - name: ua_os_major
        title: Ua Os Major
        formula: $ua_os_major

      - name: ua_os_minor
        title: Ua Os Minor
        formula: $ua_os_minor

      - name: ua_wmf_app_version
        title: Ua Wmf App Version
        formula: $ua_wmf_app_version

      - name: zero
        title: Zero carrier
        formula: $zero

    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: view_count
        title: View Count
        formula: $main.sum($view_count)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: mediawiki-history-beta
    title: Mediawiki History [beta]
    # Mediawiki history, cleaned and shaped to be analytics-friendly.  When using, make sure to filter first by event_entity and event_type, see documentation here: https://wikitech.wikimedia.org/wiki/Analytics/Data_Lake/Mediawiki_history.  Beta means this cube is not currently being updated and the data has not been fully vetted.  The schema may change a little bit going forward, based on what people find useful from the beta phase.  We expect to take this out of beta by March, 2017.
    description: Always filter by event_entity - Updated every month - Not fully vetted
    clusterName: druid
    source: mediawiki-history-beta
    # The refresh rule describes how often the data cube looks for new data.
    # Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC

    # This data source is not updated regularly, so a large duration is needed
    # to ensure some values get shown.
    defaultDuration: P3M

    # Commenting, hitting a bug when set
    #defaultSortMeasure: events

    # The names of measures that are selected by default
    defaultSelectedMeasures:
        - events

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    # Commenting those because are misleading instead of helpfull
    #defaultPinnedDimensions:
    #    - event_entity
    #    - event_type

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: autofill-all


  - name: pageviews-hourly
    title: Pageviews Hourly
    description: Large dataset - Last 3 months - Hourly resolution - Hourly loading
    clusterName: druid
    source: pageviews-hourly
    # The refresh rule describes how often the data cube looks for new data.
    # Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC

    #defaultDuration: P1D

    #defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    #
    # Disabling introspection as it fails to get all dimensions and measures
    introspection: none

    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: access_method
        title: Access Method
        formula: $access_method

      - name: agent_type
        title: Agent Type
        formula: $agent_type

      - name: continent
        title: Continent
        formula: $continent

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: subdivision
        title: Subdivision
        formula: $subdivision

      - name: city
        title: City
        formula: $city

      - name: language_variant
        title: Language Variant
        formula: $language_variant

      - name: project
        title: Project
        formula: $project

      - name: referer_class
        title: Referer Class
        formula: $referer_class

      - name: ua_device_family
        title: Ua Device Family
        formula: $ua_device_family

      - name: ua_browser_family
        title: Ua Browser Family
        formula: $ua_browser_family

      - name: ua_browser_major
        title: Ua Browser Major
        formula: $ua_browser_major

      - name: ua_os_family
        title: Ua Os Family
        formula: $ua_os_family

      - name: ua_os_major
        title: Ua Os Major
        formula: $ua_os_major

      - name: ua_os_minor
        title: Ua Os Minor
        formula: $ua_os_minor

      - name: ua_wmf_app_version
        title: Ua Wmf App Version
        formula: $ua_wmf_app_version

      - name: zero
        title: Zero carrier
        formula: $zero

    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: view_count
        title: View Count
        formula: $main.sum($view_count)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: banner_activity_minutely
    title: Banner Activity
    description: Small dataset - Starting December 2016 - Minutely resolution - Daily loading
    clusterName: druid
    source: banner_activity_minutely
    # The refresh rule describes how often the data cube looks for new data.
    # Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC

    #defaultDuration: P1M

    #defaultSortMeasure: normalized_request_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)
    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    #
    # Disabling introspection as it fails to get all dimensions and measures
    introspection: none

    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: anonymous
        title: Anonymous
        formula: $anonymous

      - name: banner
        title: Banner
        formula: $banner

      - name: bucket
        title: Bucket
        formula: $bucket

      - name: campaign
        title: Campaign
        formula: $campaign

      - name: country
        title: Country
        formula: $country

      - name: country_matches_geocode
        title: Country Matches Geocode
        formula: $country_matches_geocode

      - name: device
        title: Device
        formula: $device

      - name: project
        title: Project
        formula: $project

      - name: region
        title: Region
        formula: $region

      - name: sample_rate
        title: Sample Rate
        formula: $sample_rate

      - name: status_code
        title: Status Code
        formula: $status_code

      - name: uselang
        title: Uselang
        formula: $uselang

    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: request_count
        title: Request Count
        formula: $main.sum($request_count)

      - name: normalized_request_count
        title: Normalized Request Count
        formula: $main.sum($normalized_request_count)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: unique-devices-per-domain-daily
    title: Unique Devices Per Domain Daily
    description: From beginning of 2016 - Daily resolution - Per Domain
    clusterName: druid
    source: unique-devices-per-domain-daily
    # The refresh rule describes how often the data cube looks for new data.
    # Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC

    #defaultDuration: P1D

    #defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: autofill-all

  - name: webrequest
    title: Webrequest
    description: Last 7 days of webrequests sampled to 1/128
    clusterName: druid
    source: webrequest
    # The refresh rule describes how often the data cube looks for new data.
    # Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC

    #defaultDuration: P1D

    #defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: autofill-all

