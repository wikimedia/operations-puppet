# Apache configuration for Phabricator (<%= @phab_fqdn %>)
# This file is managed by Puppet.
NameVirtualHost *:80

<VirtualHost *:80>
  ServerName <%= @phab_fqdn %>
  ServerAdmin noc@wikimedia.org
  ServerSignature Off

  DocumentRoot /srv/phab/phabricator/webroot

  <Directory /srv/phab/phabricator/webroot>
    Options Indexes FollowSymLinks MultiViews
    AllowOverride None
    Order allow,deny
    allow from all
  </Directory>

  RewriteEngine on
  RewriteRule ^/rsrc/(.*)     -                       [L,QSA]
  RewriteRule ^/favicon.ico   -                       [L,QSA]
  RewriteRule ^(.*)$          /index.php?__path__=$1  [B,L,QSA]

  LogLevel warn
  ErrorLog /var/log/apache2/<%= @phab_fqdn %>_error.log
  CustomLog /var/log/apache2/<%= @phab_fqdn %>_access.log combined
</VirtualHost>
