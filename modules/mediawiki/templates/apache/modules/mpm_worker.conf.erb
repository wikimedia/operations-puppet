# worker MPM
# StartServers: initial number of server processes to start
# MinSpareThreads: minimum number of worker threads which are kept spare
# MaxSpareThreads: maximum number of worker threads which are kept spare
# ThreadLimit: ThreadsPerChild can be changed to this maximum value during a
#                         graceful restart. ThreadLimit can only be changed by stopping
#                         and starting Apache.
# ThreadsPerChild: constant number of worker threads in each server process
# MaxRequestWorkers: maximum number of threads
# MaxConnectionsPerChild: maximum number of requests a server process serves

<IfModule mpm_worker_module>
        ServerLimit              <%= (scope.lookupvar('::mediawiki:::web::apache_server_limit') / 25).to_i + 1 %>
        StartServers             2
        MinSpareThreads          <%= [scope.lookupvar('::mediawiki::web::max_req_workers').to_i, 25].min %>
        MaxSpareThreads          <%= scope.lookupvar('::mediawiki::web::max_req_workers') %>
        ThreadLimit              256
        ThreadsPerChild          25
        MaxRequestWorkers        <%= scope.lookupvar('::mediawiki::web::max_req_workers') %>
        MaxConnectionsPerChild   10000
</IfModule>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
