<VirtualHost *:80>
    ServerName <%= scope['::fqdn'] %>
    DocumentRoot "/var/www/monitoring"

    <Directory "/var/www/monitoring">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>

        # Allow calling from localhost and the private network.
        <IfVersion >= 2.4>
            Require ip 127.0.0.1 10.0.0.0/8
        </IfVersion>
        <IfVersion < 2.4>
            Order deny,allow
            Deny from all
            Allow from 127.0.0.1
            Allow from 10.0.0.0/8
        </IfVersion>
    </Directory>

    # Neat aliases for monitoring scripts
    <% @endpoints.each do |mountpoint, filepath| -%>
    Alias /<%= mountpoint %> /var/www/monitoring/<%= filepath %>
    <% end %>
</VirtualHost>
