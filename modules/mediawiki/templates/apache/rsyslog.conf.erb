# rsyslog configuration for MediaWiki on Apache
# This file is managed by Puppet

# Emulate MediaWiki's wfDebugLog / wfErrorLog format
$template MediaWiki,"%programname% %timegenerated% %HOSTNAME%: %msg%\n"

# Maximum 100MB log file size
$outchannel apache2,/var/log/apache2.log,100000000,/usr/sbin/logrotate -f /etc/logrotate.d/mediawiki_apache

# Send apache2 messages to the apache output channel
:programname,isequal,"apache2" $apache2

# ..and to the MediaWiki log aggregator
& @<%= @apache_log_aggregator %>;MediaWiki

# Discard apache2 messages before they get to 50-default.conf
& ~

# Send HHVM messages to the MediaWiki log aggregator
:programname,isequal,"hhvm" @<%= @apache_log_aggregator %>;MediaWiki

# Discard HHVM messages before they get to 50-default.conf
& ~
