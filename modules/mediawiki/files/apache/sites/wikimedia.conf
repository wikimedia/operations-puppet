# Chapter wikis
# Local user groups assimilated by AffCom to chapters are also added in this vhost.
<VirtualHost *:80>
    ServerName wikimedia-chapter
    ServerAlias ar.wikimedia.org am.wikimedia.org bd.wikimedia.org be.wikimedia.org br.wikimedia.org ca.wikimedia.org cn.wikimedia.org co.wikimedia.org dk.wikimedia.org ec.wikimedia.org ee.wikimedia.org fi.wikimedia.org hi.wikimedia.org il.wikimedia.org mai.wikimedia.org mk.wikimedia.org mx.wikimedia.org nl.wikimedia.org no.wikimedia.org noboard-chapters.wikimedia.org nyc.wikimedia.org nz.wikimedia.org pa-us.wikimedia.org pl.wikimedia.org pt.wikimedia.org romd.wikimedia.org rs.wikimedia.org ru.wikimedia.org se.wikimedia.org tr.wikimedia.org ua.wikimedia.org us.wikimedia.org wb.wikimedia.org
    UseCanonicalName off

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]
    RewriteMap lowercase int:tolower

    # Uploads to the host-specific directory
    # First grab the subdomain from HTTP_HOST
    RewriteCond %{HTTP_HOST} ([a-z\-]+)\.wikimedia\.org
    # Now use it
    RewriteRule ^/upload/(.*)$ %{ENV:RW_PROTO}://upload.wikimedia.org/wikimedia.org/%1/$1 [R=302]

    # www. prefix
    RewriteCond %{HTTP_HOST} ^www.([a-z]+).wikimedia.org$
    RewriteRule ^(.*)$ %{ENV:RW_PROTO}://%1.wikimedia.org$1 [R=301,L]

    Include "sites-enabled/wikimedia-common.incl"
    Include "sites-enabled/wikimedia-legacy.incl"
</VirtualHost>

# loginwiki
<VirtualHost *:80>
    ServerName login.wikimedia.org
    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>

# transitionteam private wiki - T82329
<VirtualHost *:80>
    ServerName transitionteam.wikimedia.org

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://transitionteam.wikimedia.org/$1 [R=301,L,NE]
    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>

# iegcom private wiki - T82498
<VirtualHost *:80>
    ServerName iegcom.wikimedia.org

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://iegcom.wikimedia.org/$1 [R=301,L,NE]

    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>

# legalteamwiki bugzilla:61222
<VirtualHost *:80>
    ServerName legalteam.wikimedia.org

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://legalteam.wikimedia.org/$1 [R=301,L,NE]

    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>

# zerowiki T83475
<VirtualHost *:80>
    ServerName zero.wikimedia.org
    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://zero.wikimedia.org/$1 [R=301,L,NE]
    Include "sites-enabled/wikimedia-common.incl"
</VirtualHost>

# vim: sts=4 sw=4 syn=apache autoindent
