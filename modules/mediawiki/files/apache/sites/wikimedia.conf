# Chapter wikis
<VirtualHost *>
    ServerName wikimedia-chapter
    ServerAlias no.wikimedia.org nl.wikimedia.org www.nl.wikimedia.org pl.wikimedia.org nz.wikimedia.org il.wikimedia.org rs.wikimedia.org pa-us.wikimedia.org us.wikimedia.org se.wikimedia.org ru.wikimedia.org ua.wikimedia.org co.wikimedia.org fi.wikimedia.org ve.wikimedia.org br.wikimedia.org dk.wikimedia.org tr.wikimedia.org noboard-chapters.wikimedia.org mk.wikimedia.org et.wikimedia.org nyc.wikimedia.org mx.wikimedia.org ar.wikimedia.org bd.wikimedia.org be.wikimedia.org
    UseCanonicalName off
    DocumentRoot "/usr/local/apache/common/docroot/wikimedia.org"

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]
    RewriteMap lowercase int:tolower

    # Uploads to the host-specific directory
    # First grab the subdomain from HTTP_HOST
    RewriteCond %{HTTP_HOST} ([a-z\-]+)\.wikimedia\.org
    # Now use it
    RewriteRule ^/upload/(.*)$ %{ENV:RW_PROTO}://upload.wikimedia.org/wikimedia.org/%1/$1 [R=302]

    # Primary wiki redirector:
    Alias /wiki /usr/local/apache/common/docroot/wikimedia.org/w/index.php
    RewriteRule ^/$ /w/index.php

    # www. prefix
    RewriteCond %{HTTP_HOST} ^www.([a-z]+).wikimedia.org$
    RewriteRule ^(.*)$ %{ENV:RW_PROTO}://%1.wikimedia.org$1 [R=301,L]

    # UseMod compatibility URLs
    RewriteCond %{QUERY_STRING} ([^&;]+)
    RewriteRule ^/wiki\.cgi$ %{ENV:RW_PROTO}://%{SERVER_NAME}/w/index.php?title=%1 [R=301,L]
    RewriteRule ^/wiki\.cgi$ %{ENV:RW_PROTO}://%{SERVER_NAME}/w/index.php [R=301,L]

    RewriteRule ^/math/(.*) %{ENV:RW_PROTO}://upload.wikimedia.org/math/$1 [R=301]

    # Configurable favicon
    RewriteRule ^/favicon\.ico$ /w/favicon.php [L]

    # Load robots.txt from the wiki
    RewriteRule ^/robots.txt$ /w/robots.php [L]

    <Directory "/usr/local/apache/common/docroot/wikimedia.org/w">
       <IfModule mod_php5.c>
           php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/wikimedia.org/w/extensions">
       <IfModule mod_php5.c>
           php_admin_flag engine off
        </IfModule>
    </Directory>

    # Stats
    RewriteRule ^/stats(/(.*$)|$) %{ENV:RW_PROTO}://www.wikimedia.org/stats/%{SERVER_NAME}/$1 [R=301,L]
    # Load robots.txt from the wiki
    RewriteRule ^/robots.txt$ /w/robots.php [L]

</VirtualHost>

#bits
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/bits/"
    ServerName bits.wikimedia.org

    # Version-independent aliases for backwards-compatibility
    Alias /w/extensions/ /usr/local/apache/common/docroot/wikimedia.org/w/extensions/
    Alias /skins-1.5/ /usr/local/apache/common/php/skins/
    Alias /skins/ /usr/local/apache/common/php/skins/

    Alias /images/ /usr/local/apache/common/images/
    <Directory "/usr/local/apache/common/docroot/bits/w">
       <IfModule mod_php5.c>
           php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/bits/w/extensions">
       <IfModule mod_php5.c>
           php_admin_flag engine off
        </IfModule>
    </Directory>
    # Cache fonts in static-current/extensions for as long as possible.
    # Primarily here for UniversalLanguageSelector.
    <Directory "/usr/local/apache/common/docroot/bits/static-current/extensions">
        <IfModule mod_headers.c>
            <FilesMatch "\.(eot|ttf|woff)$">
                Header set Cache-control "max-age=31536000"
            </FilesMatch>
        </IfModule>
    </Directory>

    # Used for Firefox OS web application manifest living on bits.wikimedia.org
    AddType application/x-web-app-manifest+json .webapp
</VirtualHost>

# loginwiki
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/login"
    ServerName login.wikimedia.org

    AllowEncodedSlashes On

    RewriteEngine On

    # Primary wiki redirector:
    Alias /wiki /usr/local/apache/common/docroot/login/w/index.php
    RewriteRule ^/$ /w/index.php

    # Configurable favicon
    RewriteRule ^/favicon\.ico$ /w/favicon.php [L]

    # Load robots.txt from the wiki
    RewriteRule ^/robots.txt$ /w/robots.php [L]

    <Directory "/usr/local/apache/common/docroot/login/w">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/login/w/extensions">
        <IfModule mod_php5.c>
            php_admin_flag engine off
        </IfModule>
    </Directory>
</VirtualHost>

# transitionteam private wiki - RT-4850
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/transitionteam"
    ServerName transitionteam.wikimedia.org

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://transitionteam.wikimedia.org/$1 [R=301,L]

    # Primary wiki redirector:
    Alias /wiki /usr/local/apache/common/docroot/transitionteam/w/index.php
    RewriteRule ^/$ /w/index.php

    RewriteRule ^/math/(.*) https://upload.wikimedia.org/math/$1 [R=301]

    # Configurable favicon
    RewriteRule ^/favicon\.ico$ /w/favicon.php [L]

    <Directory "/usr/local/apache/common/docroot/transitionteam/w">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/transitionteam/w/extensions">
        <IfModule mod_php5.c>
            php_admin_flag engine off
        </IfModule>
    </Directory>
</VirtualHost>

# iegcom private wiki - RT-5042
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/iegcom"
    ServerName iegcom.wikimedia.org

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://iegcom.wikimedia.org/$1 [R=301,L]

    # Primary wiki redirector:
    Alias /wiki /usr/local/apache/common/docroot/iegcom/w/index.php
    RewriteRule ^/$ /w/index.php

    RewriteRule ^/math/(.*) https://upload.wikimedia.org/math/$1 [R=301]

    # Configurable favicon
    RewriteRule ^/favicon\.ico$ /w/favicon.php [L]

    <Directory "/usr/local/apache/common/docroot/iegcom/w">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/iegcom/w/extensions">
        <IfModule mod_php5.c>
            php_admin_flag engine off
        </IfModule>
    </Directory>
</VirtualHost>

# legalteamwiki bugzilla:61222
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/wikimedia.org"
    ServerName legalteam.wikimedia.org

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://legalteam.wikimedia.org/$1 [R=301,L]

    # Primary wiki redirector:
    Alias /wiki /usr/local/apache/common/docroot/wikimedia.org/w/index.php
    RewriteRule ^/$ /w/index.php

    RewriteRule ^/math/(.*) http://upload.wikimedia.org/math/$1 [R=301]

    # Configurable favicon
    RewriteRule ^/favicon\.ico$ /w/favicon.php [L]

    <Directory "/usr/local/apache/common/docroot/wikimedia.org/w">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/wikimedia.org/w/extensions">
        <IfModule mod_php5.c>
            php_admin_flag engine off
        </IfModule>
    </Directory>
</VirtualHost>

# zerowiki RT #6831
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/wikimedia.org"
    ServerName zero.wikimedia.org

    AllowEncodedSlashes On

    RewriteEngine On
    RewriteCond %{HTTP:X-Forwarded-Proto} !https
    RewriteRule ^/(.*)$ https://zero.wikimedia.org/$1 [R=301,L]

    # Primary wiki redirector:
    Alias /wiki /usr/local/apache/common/docroot/wikimedia.org/w/index.php
    RewriteRule ^/$ /w/index.php

    RewriteRule ^/math/(.*) http://upload.wikimedia.org/math/$1 [R=301]

    # Configurable favicon
    RewriteRule ^/favicon\.ico$ /w/favicon.php [L]

    <Directory "/usr/local/apache/common/docroot/wikimedia.org/w">
        <IfModule mod_php5.c>
            php_admin_flag engine on
        </IfModule>
    </Directory>
    <Directory "/usr/local/apache/common/docroot/wikimedia.org/w/extensions">
        <IfModule mod_php5.c>
            php_admin_flag engine off
        </IfModule>
    </Directory>
</VirtualHost>

# wikimedia.org
<VirtualHost *>
    DocumentRoot "/usr/local/apache/common/docroot/wwwportal"
    # bare wikimedia.org is in redirects.dat
    ServerName www.wikimedia.org
    ServerAlias *.wikimedia.org # FIXME: Should this still be here?

    RewriteEngine On
    RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
    RewriteCond %{ENV:RW_PROTO} !=https
    RewriteRule . - [E=RW_PROTO:http]

    # Main page portal
    RewriteRule ^/$ /w/extract2.php?title=Www.wikimedia.org_portal&template=Www.wikimedia.org_template [L]

    # Redirects for country portals from the old URLs
    RewriteRule ^/ch-portal/?$ http://wikipedia.ch/ [R=301,L]
    RewriteRule ^/be-portal/?$ http://wikipedia.be/ [R=301,L]
    RewriteRule ^/nl-portal/?$ http://wikipedia.nl/ [R=301,L]

    AddDefaultCharset Off
    ExpiresActive On

    # Redirect wiki which was previously at this location
    RewriteRule ^/wiki/(.*)$ %{ENV:RW_PROTO}://wikimediafoundation.org/wiki/$1 [R=301,L]

  <Directory "/usr/local/apache/common/docroot/wwwportal/w">
   <IfModule mod_php5.c>
    php_admin_flag engine on
   </IfModule>
  </Directory>

</VirtualHost>

# vim: sts=4 sw=4 syn=apache autoindent
