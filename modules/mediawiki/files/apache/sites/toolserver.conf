<VirtualHost *:80>
        ServerName www.toolserver.org
        ServerAlias toolserver.org stable.toolserver.org ortelius.toolserver.org wolfsbane.toolserver.org tools.wikimedia.de

        # Allow caching for redirects.
        <IfModule mod_headers.c>
                Header set Cache-control "s-maxage=86000, max-age=0, must-revalidate"
        </IfModule>
        <IfModule mod_expires.c>
                ExpiresActive On
                ExpiresByType image/gif A2592000
                ExpiresByType image/png A2592000
                ExpiresByType image/jpeg A2592000
                ExpiresByType text/css A2592000
                ExpiresByType text/javascript A2592000
                ExpiresByType application/x-javascript A2592000
                ExpiresByType text/html A2592000
        </IfModule>

        DocumentRoot /usr/local/apache/common/docroot/default

        RewriteEngine On

        # Set %{ENV:RW_PROTO} to the protocol that we have been called
        # with.
        RewriteRule . - [E=RW_PROTO:%{HTTP:X-Forwarded-Proto}]
        RewriteCond %{ENV:RW_PROTO} !=https
        RewriteRule . - [E=RW_PROTO:http]

        # Tools moved elsewhere.
        RewriteRule ^/~daniel/potd(/.*)?$ %{ENV:RW_PROTO}://tools.wmflabs.org/potd-feed$1 [R=permanent,L]
        RewriteRule ^/~timl/wikilint(/.*)?$ %{ENV:RW_PROTO}://tools.wmflabs.org/wikilint$1 [R=permanent,L]
        RewriteRule ^/~pietrodn/intersectContribs\.php$ %{ENV:RW_PROTO}://tools.wmflabs.org/intersect-contribs/ [R=permanent,L]
        RewriteRule ^/~pietrodn/sectionLinks\.php$ %{ENV:RW_PROTO}://tools.wmflabs.org/section-links/ [R=permanent,L]

        # By default, redirect everything to [[meta:Toolserver]].
        RewriteRule ^.*$ %{ENV:RW_PROTO}://meta.wikimedia.org/wiki/Toolserver [R,L]
</VirtualHost>
