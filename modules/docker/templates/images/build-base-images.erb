#!/bin/bash
# This script builds all the base images we need and pushes
# them to the appropriate docker registry
set -e

<%- if @distributions.include?('jessie') -%>
# Build debian jessie image!
/usr/bin/bootstrap-vz /srv/images/base/jessie.yaml

# Push it to the repository
docker push <%= @docker_registry %>/wikimedia-jessie
<%- end -%>

<%- if @distributions.include?('stretch') -%>
# Build debian stretch image!
/usr/bin/bootstrap-vz /srv/images/base/stretch.yaml

# Push it to the repository
docker push <%= @docker_registry %>/wikimedia-stretch
<%- end -%>


<%- if @distributions.include?('alpine') -%>
/usr/local/bin/build-alpine
<%- end -%>
