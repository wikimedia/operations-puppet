[DEFAULT]

#
# From keystone
#
 
# A "shared secret" that can be used to bootstrap Keystone. This "token" does
# not represent a user, and carries no explicit authorization. To disable in
# production (highly recommended), remove AdminTokenAuthMiddleware from your
# paste application pipelines (for example, in keystone-paste.ini). (string
# value)
admin_token = <%= @keystoneconfig["admin_token"] %>
 
# The base public endpoint URL for Keystone that is advertised to clients
# (NOTE: this does NOT affect how Keystone listens for connections). Defaults
# to the base host URL of the request. E.g. a request to
# http://server:5000/v3/users will default to http://server:5000. You should
# only need to set this value if the base URL contains a path (e.g. /prefix/v3)
# or the endpoint should be found on a different server. (string value)
#public_endpoint = <None>
 
# The base admin endpoint URL for Keystone that is advertised to clients (NOTE:
# this does NOT affect how Keystone listens for connections). Defaults to the
# base host URL of the request. E.g. a request to http://server:35357/v3/users
# will default to http://server:35357. You should only need to set this value
# if the base URL contains a path (e.g. /prefix/v3) or the endpoint should be
# found on a different server. (string value)
#admin_endpoint = <None>
 
# Maximum depth of the project hierarchy. WARNING: setting it to a large value
# may adversely impact performance. (integer value)
#max_project_tree_depth = 5
 
# Limit the sizes of user & project ID/names. (integer value)
#max_param_size = 64
 
# Similar to max_param_size, but provides an exception for token values.
# (integer value)
#max_token_size = 8192
 
# Similar to the member_role_name option, this represents the default role ID
# used to associate users with their default projects in the v2 API. This will
# be used as the explicit role where one is not specified by the v2 API.
# (string value)
#member_role_id = 9fe2ff9ee4384b1894a90878d3e92bab
 
# This is the role name used in combination with the member_role_id option; see
# that option for more detail. (string value)
#member_role_name = _member_
 
# The value passed as the keyword "rounds" to passlib's encrypt method.
# (integer value)
# Minimum value: 1000
# Maximum value: 100000
#crypt_strength = 10000
 
# The maximum number of entities that will be returned in a collection, with no
# limit set by default. This global limit may be then overridden for a specific
# driver, by specifying a list_limit in the appropriate section (e.g.
# [assignment]). (integer value)
#list_limit = <None>
 
# Set this to false if you want to enable the ability for user, group and
# project entities to be moved between domains by updating their domain_id.
# Allowing such movement is not recommended if the scope of a domain admin is
# being restricted by use of an appropriate policy file (see
# policy.v3cloudsample as an example). (boolean value)
#domain_id_immutable = true
 
# If set to true, strict password length checking is performed for password
# manipulation. If a password exceeds the maximum length, the operation will
# fail with an HTTP 403 Forbidden error. If set to false, passwords are
# automatically truncated to the maximum length. (boolean value)
#strict_password_check = false
 
# The HTTP header used to determine the scheme for the original request, even
# if it was removed by an SSL terminating proxy. Typical value is
# "HTTP_X_FORWARDED_PROTO". (string value)
#secure_proxy_ssl_header = <None>
 
#
# From keystone.notifications
#
 
# Default publisher_id for outgoing notifications (string value)
#default_publisher_id = <None>
 
# Define the notification format for Identity Service events. A "basic"
# notification has information about the resource being operated on. A "cadf"
# notification has the same information, as well as information about the
# initiator of the event. (string value)
# Allowed values: basic, cadf
#notification_format = basic
 
#
# From oslo.log
#
 
# Print debugging output (set logging level to DEBUG instead of default INFO
# level). (boolean value)
debug = false
 
# If set to false, will disable INFO logging level, making WARNING the default.
# (boolean value)
# This option is deprecated for removal.
# Its value may be silently ignored in the future.
verbose = false
 
# The name of a logging configuration file. This file is appended to any
# existing logging configuration files. For details about logging configuration
# files, see the Python logging module documentation. (string value)
# Deprecated group/name - [DEFAULT]/log_config
log_config_append = /etc/keystone/logging.conf
 
# DEPRECATED. A logging.Formatter log message format string which may use any
# of the available logging.LogRecord attributes. This option is deprecated.
# Please use logging_context_format_string and logging_default_format_string
# instead. (string value)
#log_format = <None>
 
# Format string for %%(asctime)s in log records. Default: %(default)s . (string
# value)
#log_date_format = %Y-%m-%d %H:%M:%S
 
# (Optional) Name of log file to output to. If no default is set, logging will
# go to stdout. (string value)
# Deprecated group/name - [DEFAULT]/logfile
log_file = keystone.log
 
# (Optional) The base directory used for relative --log-file paths. (string
# value)
# Deprecated group/name - [DEFAULT]/logdir
log_dir = /var/log/keystone
 
# Use syslog for logging. Existing syslog format is DEPRECATED and will be
# changed later to honor RFC5424. (boolean value)
#use_syslog = false
 
# (Optional) Enables or disables syslog rfc5424 format for logging. If enabled,
# prefixes the MSG part of the syslog message with APP-NAME (RFC5424). The
# format without the APP-NAME is deprecated in Kilo, and will be removed in
# Mitaka, along with this option. (boolean value)
# This option is deprecated for removal.
# Its value may be silently ignored in the future.
#use_syslog_rfc_format = true
 
# Syslog facility to receive log lines. (string value)
#syslog_log_facility = LOG_USER
 
# Log output to standard error. (boolean value)
#use_stderr = true
 
# Format string to use for log messages with context. (string value)
#logging_context_format_string = %(asctime)s.%(msecs)03d %(process)d %(levelname)s %(name)s [%(request_id)s %(user_identity)s] %(instance)s%(message)s
 
# Format string to use for log messages without context. (string value)
#logging_default_format_string = %(asctime)s.%(msecs)03d %(process)d %(levelname)s %(name)s [-] %(instance)s%(message)s
 
# Data to append to log format when level is DEBUG. (string value)
#logging_debug_format_suffix = %(funcName)s %(pathname)s:%(lineno)d
 
# Prefix each line of exception output with this format. (string value)
#logging_exception_prefix = %(asctime)s.%(msecs)03d %(process)d ERROR %(name)s %(instance)s
 
# List of logger=LEVEL pairs. (list value)
#default_log_levels = amqp=WARN,amqplib=WARN,boto=WARN,qpid=WARN,sqlalchemy=WARN,suds=INFO,oslo.messaging=INFO,iso8601=WARN,requests.packages.urllib3.connectionpool=WARN,urllib3.connectionpool=WARN,websocket=WARN,requests.packages.urllib3.util.retry=WARN,urllib3.util.retry=WARN,keystonemiddleware=WARN,routes.middleware=WARN,stevedore=WARN,taskflow=WARN
 
# Enables or disables publication of error events. (boolean value)
#publish_errors = false
 
# The format for an instance that is passed with the log message. (string
# value)
#instance_format = "[instance: %(uuid)s] "
 
# The format for an instance UUID that is passed with the log message. (string
# value)
#instance_uuid_format = "[instance: %(uuid)s] "
 
# Enables or disables fatal status of deprecations. (boolean value)
#fatal_deprecations = false
 
#
# From oslo.messaging
#
 
# Size of RPC connection pool. (integer value)
# Deprecated group/name - [DEFAULT]/rpc_conn_pool_size
#rpc_conn_pool_size = 30
 
# ZeroMQ bind address. Should be a wildcard (*), an ethernet interface, or IP.
# The "host" option should point or resolve to this address. (string value)
#rpc_zmq_bind_address = *
 
# MatchMaker driver. (string value)
#rpc_zmq_matchmaker = local
 
# ZeroMQ receiver listening port. (integer value)
#rpc_zmq_port = 9501
 
# Number of ZeroMQ contexts, defaults to 1. (integer value)
#rpc_zmq_contexts = 1
 
# Maximum number of ingress messages to locally buffer per topic. Default is
# unlimited. (integer value)
#rpc_zmq_topic_backlog = <None>
 
# Directory for holding IPC sockets. (string value)
#rpc_zmq_ipc_dir = /var/run/openstack
 
# Name of this node. Must be a valid hostname, FQDN, or IP address. Must match
# "host" option, if running Nova. (string value)
#rpc_zmq_host = localhost
 
# Seconds to wait before a cast expires (TTL). Only supported by impl_zmq.
# (integer value)
#rpc_cast_timeout = 30
 
# Heartbeat frequency. (integer value)
#matchmaker_heartbeat_freq = 300
 
# Heartbeat time-to-live. (integer value)
#matchmaker_heartbeat_ttl = 600
 
# Size of executor thread pool. (integer value)
# Deprecated group/name - [DEFAULT]/rpc_thread_pool_size
#executor_thread_pool_size = 64
 
# The Drivers(s) to handle sending notifications. Possible values are
# messaging, messagingv2, routing, log, test, noop (multi valued)
notification_driver = wmfkeystonehooks

# Login info for wikitech, for project page updates
wiki_host=<%= @wikitechstatusconfig["host"] %>
wiki_domain=<%= @wikitechstatusconfig["domain"] %>
wiki_page_prefix=<%= @wikitechstatusconfig["page_prefix"] %>
wiki_instance_region=<%= @wikitechstatusconfig["region"] %>
wiki_login=<%= @wikitechstatusconfig["user"] %>
wiki_password=<%= @wikitechstatusconfig["pass"] %>
wiki_instance_dns_domain=<%= @wikitechstatusconfig["dns_domain"] %>
 

# AMQP topic used for OpenStack notifications. (list value)
# Deprecated group/name - [rpc_notifier2]/topics
#notification_topics = notifications
 
# Seconds to wait for a response from a call. (integer value)
#rpc_response_timeout = 60
 
# A URL representing the messaging driver to use and its full configuration. If
# not set, we fall back to the rpc_backend option and driver specific
# configuration. (string value)
#transport_url = <None>
 
# The messaging driver to use, defaults to rabbit. Other drivers include qpid
# and zmq. (string value)
#rpc_backend = rabbit
 
# The default exchange under which topics are scoped. May be overridden by an
# exchange name specified in the transport_url option. (string value)
#control_exchange = keystone
 
#
# From oslo.service.service
#
 
# Enable eventlet backdoor.  Acceptable values are 0, <port>, and
# <start>:<end>, where 0 results in listening on a random tcp port number;
# <port> results in listening on the specified port number (and not enabling
# backdoor if that port is in use); and <start>:<end> results in listening on
# the smallest unused port number within the specified range of port numbers.
# The chosen port is displayed in the service's log file. (string value)
#backdoor_port = <None>
 
# Enables or disables logging values of all registered options when starting a
# service (at DEBUG level). (boolean value)
#log_options = true

[assignment]
driver = sql
 

[eventlet_server]
# The IP address of the network interface to listen on
# bind_host = 0.0.0.0

# The port number which the public service listens on
# public_port = 5000

# The port number which the public admin listens on
admin_port = <%= @keystoneconfig["auth_port"] %>

# The port number which the OpenStack Compute service listens on
# compute_port = 8774


[sql]
# the timeout before idle sql connections are reaped
# idle_timeout = 200

[database]
# The SQLAlchemy connection string used to connect to the database
connection = mysql://<%= @keystoneconfig["db_user"] %>:<%= @keystoneconfig["db_pass"] %>@<%= @keystoneconfig["db_host"] %>/<%= @keystoneconfig["db_name"] %>

[identity]
driver = ldap

[cache]
 
#
# From keystone
#
 
# Prefix for building the configuration dictionary for the cache region. This
# should not need to be changed unless there is another dogpile.cache region
# with the same configuration name. (string value)
#config_prefix = cache.keystone
 
# Default TTL, in seconds, for any cached item in the dogpile.cache region.
# This applies to any cached method that doesn't have an explicit cache
# expiration time defined for it. (integer value)
#expiration_time = 600
 
# Dogpile.cache backend module. It is recommended that Memcache with pooling
# (keystone.cache.memcache_pool) or Redis (dogpile.cache.redis) be used in
# production deployments.  Small workloads (single process) like devstack can
# use the dogpile.cache.memory backend. (string value)
#backend = keystone.common.cache.noop
 
# Arguments supplied to the backend module. Specify this option once per
# argument to be passed to the dogpile.cache backend. Example format:
# "<argname>:<value>". (multi valued)
#backend_argument =
 
# Proxy classes to import that will affect the way the dogpile.cache backend
# functions. See the dogpile.cache documentation on changing-backend-behavior.
# (list value)
#proxies =
 
# Global toggle for all caching using the should_cache_fn mechanism. (boolean
# value)
#enabled = false
 
# Extra debugging from the cache backend (cache keys, get/set/delete/etc
# calls). This is only really useful if you need to see the specific cache-
# backend get/set/delete calls with the keys/values.  Typically this should be
# left set to false. (boolean value)
#debug_cache_backend = false
 
# Memcache servers in the format of "host:port". (dogpile.cache.memcache and
# keystone.cache.memcache_pool backends only). (list value)
#memcache_servers = localhost:11211
 
# Number of seconds memcached server is considered dead before it is tried
# again. (dogpile.cache.memcache and keystone.cache.memcache_pool backends
# only). (integer value)
#memcache_dead_retry = 300
 
# Timeout in seconds for every call to a server. (dogpile.cache.memcache and
# keystone.cache.memcache_pool backends only). (integer value)
#memcache_socket_timeout = 3
 
# Max total number of open connections to every memcached server.
# (keystone.cache.memcache_pool backend only). (integer value)
#memcache_pool_maxsize = 10
 
# Number of seconds a connection to memcached is held unused in the pool before
# it is closed. (keystone.cache.memcache_pool backend only). (integer value)
#memcache_pool_unused_timeout = 60
 
# Number of seconds that an operation will wait to get a memcache client
# connection. (integer value)
#memcache_pool_connection_get_timeout = 10

[catalog]
# dynamic, sql-based backend (supports API/CLI-based management commands)
driver = sql

# static, file-based backend (does *NOT* support any management commands)
# driver = keystone.catalog.backends.templated.TemplatedCatalog

# template_file = default_catalog.templates

[token]
provider = uuid
driver = sql

# Amount of time a token should remain valid (in seconds)
# Using 7.1 days, as we'll set MediaWiki to 7 days
expiration = 613440

[policy]
driver = rules

[eventlet_server_ssl]
enable = False
#certfile = /etc/keystone/ssl/certs/keystone.pem
#keyfile = /etc/keystone/ssl/private/keystonekey.pem
#ca_certs = /etc/keystone/ssl/certs/ca.pem
#cert_required = True

[signing]
#provider = uuid
#certfile = /etc/keystone/ssl/certs/signing_cert.pem
#keyfile = /etc/keystone/ssl/private/signing_key.pem
#ca_certs = /etc/keystone/ssl/certs/ca.pem
#key_size = 1024
#valid_days = 3650
#ca_password = None
#token_format = PKI

[ldap]
url = ldap://<%= @keystoneconfig["ldap_host"] %>
tree_dn = <%= @keystoneconfig["ldap_base_dn"] %>
user_tree_dn = ou=people,<%= @keystoneconfig["ldap_base_dn"] %>
user_id_attribute = <%= @keystoneconfig["ldap_user_id_attribute"] %>
user_name_attribute = <%= @keystoneconfig["ldap_user_name_attribute"] %>
user = <%= @keystoneconfig["ldap_user_dn"] %>
password = <%= @keystoneconfig["ldap_user_pass"] %>

[auth]
methods = external,password,token,wmtotp

wmtotp = keystone.auth.plugins.wmtotp.Wmtotp
# Override the default password plugin with a custom
#  one that checks source IPs.
password = keystone.auth.plugins.password_whitelist.PasswordWhitelist

<% @labs_networks.each do |subnet| -%>
password_whitelist = novaobserver:<%=subnet%>
<% end -%>
<% @prod_networks.each do |subnet| -%>
password_whitelist = *:<%=subnet%>
<% end -%>

[oath]

dbuser = <%= @keystoneconfig["oath_dbuser"] %>
dbpass = <%= @keystoneconfig["oath_dbpass"] %>
dbname = <%= @keystoneconfig["oath_dbname"] %>
dbhost = <%= @keystoneconfig["oath_dbhost"] %>



[DEFAULT]

verbose=True
auth_strategy=keystone
compute_driver=nova.virt.libvirt.LibvirtDriver
notification_topics=notifications,ceilometer_notifications
connection_type=libvirt
root_helper=sudo nova-rootwrap /etc/nova/rootwrap.conf
instance_name_template=i-%08x
daemonize=1
scheduler_driver=nova.scheduler.filter_scheduler.FilterScheduler
wmf_scheduler_hosts_pool=<%= @novaconfig["scheduler_pool"].join(",") %>
scheduler_default_filters=RetryFilter,AvailabilityZoneFilter,RamFilter,ComputeFilter,ComputeCapabilitiesFilter,ImagePropertiesFilter,ServerGroupAntiAffinityFilter,ServerGroupAffinityFilter,AggregateInstanceExtraSpecsFilter,AvailabilityZoneFilter,SchedulerPoolFilter,DiskFilter

# Don't allow duplicate instance names
osapi_compute_unique_server_name_scope='global'

# Security groups for big projects (e.g. tools) are too hard to
#  organize and cause a timeout between conductor and compute.
# This is /maybe/ fixed in mitaka, so we can investigate reverting
#  this to 60 (the proper default) in future versions.
rpc_response_timeout=180

my_ip=<%= @novaconfig["my_ip"] %>
log_dir=/var/log/nova
state_path=/var/lib/nova
lock_path=/var/lock/nova
sql_connection=mysql://<%= @novaconfig["db_user"] %>:<%= @novaconfig["db_pass"] %>@<%= @novaconfig["db_host"] %>/<%= @novaconfig["db_name"] %>
image_service=nova.image.glance.GlanceImageService
remove_unused_base_images=True
s3_host=<%= @novaconfig["glance_host"] %>
glance_api_servers=<%= @novaconfig["glance_host"] %>:9292
cc_host=<%= @novaconfig["cc_host"] %>
ec2_url=http://<%= @novaconfig["api_host"] %>:8773/services/Cloud
ec2_dmz_host=<%= @novaconfig["api_ip"] %>
dmz_cidr=<%= @novaconfig["dmz_cidr"] %>
dhcpbridge_flagfile=/etc/nova/nova.conf
dhcpbridge=/usr/bin/nova-dhcpbridge
dhcp_domain=<%= @novaconfig["dhcp_domain"] %>

# Default quotas for new projects:  1 xlarge instance
#  (or 4 medium, or 8 small)
quota_cores = 8
quota_instances = 8
quota_ram = 16384
quota_floating_ips=<%= @novaconfig["quota_floating_ips"] %>
quota_fixed_ips=200

# Quota drift is a common problem
max_age = 30


api_paste_config=/etc/nova/api-paste.ini
#use_ipv6=True
allow_same_net_traffic=False
force_dhcp_release=True
# set the lease time to 24 hours
dhcp_lease_time=86400
# timeout expired leases after 48 hours
fixed_ip_disassociate_timeout=172800
iscsi_helper=tgtadm

network_api_class=nova.network.api.API
flat_network_dhcp_start=<%= @novaconfig["dhcp_start"] %>
network_manager=nova.network.manager.FlatDHCPManager
flat_interface=<%= @novaconfig["network_flat_interface"] %>
flat_injected=False
flat_network_bridge=<%= @novaconfig["flat_network_bridge"] %>
fixed_range=<%= @novaconfig["fixed_range"] %>
public_interface=<%= @novaconfig["network_public_interface"] %>
routing_source_ip=<%= @novaconfig["network_public_ip"] %>
multi_host=False

#  novnc stuff
vnc_enabled=False

dnsmasq_config_file=/etc/dnsmasq-nova.conf

# Settings for wikistatus, the plugin that updates OSM with instance status:
notification_driver=wikistatus
notify_on_state_change=vm_state

wiki_host=<%= @instance_status_wiki_host %>
wiki_domain=<%= @instance_status_wiki_domain %>
wiki_page_prefix=<%= @instance_status_wiki_page_prefix %>
wiki_instance_region=<%= @instance_status_wiki_region %>
wiki_login=<%= @instance_status_wiki_user %>
wiki_password=<%= @instance_status_wiki_pass %>
wiki_instance_dns_domain=<%= @instance_status_dns_domain %>

# Designate things:
notification_driver = messagingv2

# Ceilometer things:
instance_usage_audit = True
instance_usage_audit_period = hour
notify_on_state_change = vm_and_task_state

# Overprovision settings

# Running OOM on a compute host produces weird spontaneous shutdowns.
#  avoid overcommitting as long as we can afford it.
ram_allocation_ratio=1.0

# Since our images are copy-on-write we can support some overcommitting here.
disk_allocation_ratio=1.5


# Deprecated, remove in Kilo:
node_availability_zone=<%= @novaconfig["zone"] %>
zone_name=<%= @novaconfig["zone"] %>
# Should be:
#default_availability_zone = <%= @novaconfig["zone"] %>

[database]
# http://docs.sqlalchemy.org/en/latest/core/pooling.html
max_overflow = 25
max_pool_size = 10
pool_timeout = 60

[glance]
host=<%= @novaconfig["glance_host"] %>

[libvirt]
virt_type=<%= @novaconfig["libvirt_type"] %>
use_virtio_for_bridges=True
# live_migration_bandwidth is documented in the code, and nowhere else.
# 'Maximum bandwidth to be used during migration, in Mbps'
# Limit this to around a third of available 1Gbps connection so we don't
# throttle running instances when migrating.
live_migration_bandwidth=300
live_migration_uri=<%= @novaconfig["live_migration_uri"] %>

[oslo_messaging_rabbit]
rabbit_host=<%= @novaconfig["rabbit_host"] %>
rabbit_port = 5672
rabbit_use_ssl = False
rabbit_userid = <%= @novaconfig["rabbit_user"] %>
rabbit_password = <%= @novaconfig["rabbit_pass"] %>

[spice]
html5proxy_host=<%= @novaconfig['controller_hostname'] %>
html5proxy_port=6082
html5proxy_base_url=https://<%= @novaconfig['spice_hostname'] %>/spice_sec_auto.html

# These two only matter on the compute hosts:
server_listen=0.0.0.0
server_proxyclient_address=<%= @novaconfig["my_ip"] %>

# Enable spice related features (boolean value)
enabled=True

# Enable spice guest agent support (boolean value)
agent_enabled=True

# Keymap for spice (string value)
keymap=en-us

[workarounds]
# This is the safest option until evacuation is fixed in Libery
destroy_after_evacuate=False


