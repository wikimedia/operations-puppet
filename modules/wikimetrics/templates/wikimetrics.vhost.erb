<VirtualHost *:<%= @port %>>
  ServerName   <%= @server_name %>
  #ServerAlias <%= Array(@server_aliases).join(' ') %>
  DocumentRoot <%= @docroot %>
  ServerAdmin  noc@wikimedia.org

  ErrorLog /var/log/apache2/error.metrics.log
  # Possible values include: debug, info, notice, warn, error, crit,
  # alert, emerg.
  LogLevel warn

  CustomLog /var/log/apache2/access.metrics.log combined

<% if @ssl_redirect -%>
  RewriteEngine on
  # Redirect any non HTTPS request to HTTPS
  # This HTTP Header is set by Yuvi's proxy-dammit instance
  RewriteCond %{HTTP:X-Forwarded-Proto} !https
  RewriteRule ^(.*)$ https://<%= @server_name %>$1 [L,R]
<% end -%>

  WSGIDaemonProcess api user=www-data group=wikidev threads=10 python-path=<%= @docroot %>
  WSGIScriptAlias / <%= @docroot %>/api.wsgi

  <Directory <%= @docroot %>>
      WSGIProcessGroup api
      WSGIApplicationGroup %{GLOBAL}

      Options Indexes FollowSymLinks MultiViews
      AllowOverride None
      Order deny,allow
      Allow from all
  </Directory>

</VirtualHost>
