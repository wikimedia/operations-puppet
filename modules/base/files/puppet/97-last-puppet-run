#!/bin/sh
# Script that reports when Puppet last ran, in bold if more than an hour ago.

set -e

PATH=/bin:/usr/bin:/usr/local/bin
LANG=C

TSLASTPUPPETRUN=$(stat -c %Z /var/lib/puppet/state/classes.txt)
NOW=$(date +%s)
DELTAMIN=$((($NOW-$TSLASTPUPPETRUN)/60))
BOLD="\033[1m"
NORM="\033[0m"

echo -n "The last Puppet run was at $(date -d @$TSLASTPUPPETRUN) "

DISABLEDMSG="$(puppet-enabled || true)"

if [ $DELTAMIN -gt 60 ]; then
	echo "${BOLD}($DELTAMIN minutes ago)${NORM}. $DISABLEDMSG"
else
	echo "($DELTAMIN minutes ago). $DISABLEDMSG"
fi
