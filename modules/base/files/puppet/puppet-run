#!/bin/bash

set -e

timeout -k 60 300 apt-get update >/dev/null 2>&1

# We pass show-diff, show the log may be sensitive,
# so make sure it's sufficiently protected
umask 077

timeout -k 60 1800 puppet agent \
  --onetime \
  --no-daemonize \
  --verbose \
  --show_diff \
  --splay \
  --splaylimit 59 \
  >> /var/log/puppet.log 2>&1
