# Global Apache defaults
# This file is managed by Puppet

# Disable accept filters for HTTP to force Apache to accept connections from
# PyBal's IdleConnection monitor. Otherwise Apache sets the TCP_DEFER_ACCEPT
# option on sockets, which defers the accept() until there's data on the
# connection. See:
#  - https://phabricator.wikimedia.org/T119372#1852767
#  - https://httpd.apache.org/docs/2.4/mod/core.html#acceptfilter
AcceptFilter http none

# Make 'Server' response header field simply 'Apache'
ServerTokens Prod

# Reject TRACE requests with HTTP 405 error
TraceEnable Off

# Tab separated log format
# https://wikitech.wikimedia.org/wiki/Apache_log_format
<IfModule !mod_remoteip.c>
    LogFormat "%{%Y-%m-%dT%H:%M:%S}t	%D	%a	%R/%>s	%B	%m	http://%{Host}i%U%q	-	%{Content-Type}o	%{Referer}i	%{X-Forwarded-For}i	%{User-Agent}i	%{Accept-Language}i	%{X-Analytics}i	%u	%a" wmf
</IfModule>
<IfModule mod_remoteip.c>
    LogFormat "%{%Y-%m-%dT%H:%M:%S}t	%D	%a	%R/%>s	%B	%m	http://%{Host}i%U%q	-	%{Content-Type}o	%{Referer}i	%{X-Forwarded-For}i	%{User-Agent}i	%{Accept-Language}i	%{X-Analytics}i	%u	%{c}a" wmf
</IfModule>

# Define an access log for VirtualHosts that don't define their own logfile
CustomLog /var/log/apache2/other_vhosts_access.log wmf

# Set default contact address to include in error messages
ServerAdmin webmaster@wikimedia.org

# When receiving a graceful-stop signal, wait up to 5 seconds for client
# connections to close gracefully.
GracefulShutdownTimeout 5
