# https://prometheus.io/docs/practices/rules/

cluster_device:network_transmit_bytes:rate5m = sum(rate(node_network_transmit_bytes{job="node"}[5m])) by (cluster,device)
cluster_device:network_receive_bytes:rate5m = sum(rate(node_network_receive_bytes{job="node"}[5m])) by (cluster,device)

# CPU utilization and counts
cluster_mode:cpu:rate5m = avg by (cluster, mode) (rate(node_cpu{job="node"}[5m]))
instance_mode:cpu:rate5m = avg by (instance, mode) (rate(node_cpu{job="node"}[5m]))
instance_cluster:node_cpu:count = count by (instance, cluster) (node_cpu{mode="idle",job="node"})
cluster:cpu:sum = sum(instance_cluster:node_cpu:count) by (cluster)
cluster:cpu_count:sum = cluster:cpu:sum

# Aggregated memory stats
cluster:memory_MemTotal:sum = sum(node_memory_MemTotal{job="node"}) by (cluster)
cluster:memory_MemFree:sum = sum(node_memory_MemFree{job="node"}) by (cluster)
cluster:memory_Buffers:sum = sum(node_memory_Buffers{job="node"}) by (cluster)
cluster:memory_Cached:sum = sum(node_memory_Cached{job="node"}) by (cluster)
cluster:memory_SwapTotal:sum = sum(node_memory_SwapTotal{job="node"}) by (cluster)
cluster:memory_SwapFree:sum = sum(node_memory_SwapFree{job="node"}) by (cluster)

# Derived memory stats from aggregation
cluster:memory_SwapUsed:sum = cluster:memory_SwapTotal:sum - cluster:memory_SwapFree:sum
cluster:memory_Used:sum = cluster:memory_MemTotal:sum - cluster:memory_Cached:sum - cluster:memory_Buffers:sum - cluster:memory_MemFree:sum

cluster:load1:sum = sum(node_load1{job="node"}) by (cluster)
cluster:up:sum = sum(up{job="node"}) by (cluster)
cluster:up:count = count(up{job="node"}) by (cluster)
cluster:procs_running:sum = sum(node_procs_running) by (cluster)
