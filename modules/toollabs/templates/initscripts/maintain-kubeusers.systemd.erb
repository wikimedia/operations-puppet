# maintain-kubeusers
#
# A simple script that autocreates kubernetes accounts for tools users
# Also maintains infrastructure accounts
[Unit]
Description="Create & Maintain kubernetes tool & infrastructure users"

[Service]
# Run as root since it needs to write to /data/project as various users
# We attempt to restrict the paths it can write to as some form of mitigation
User=root
Group=root
ExecStart=/usr/local/bin/maintain-kubeusers \
          --infrastructure-users /etc/kubernetes/infrastructure-users \
          https://<%= @k8s_master %>:6443 /etc/kubernetes/tokenauth /etc/kubernetes/abac
ReadWriteDirectories=/data/project /etc/kubernetes
ReadOnlyDirectories=/
Restart=always

[Install]
WantedBy=multi-user.target