#!/usr/bin/python
# -*- coding: utf-8 -*-
from __future__ import print_function

import os
import re
import sys

if not (len(sys.argv) == 1 or (len(sys.argv) == 2 and sys.argv[1].isdigit())):
    print('Usage: %s BRANCH_NUMBER' % __file__, file=sys.stderr)
    sys.exit(1)

search_dir = ('/srv/mediawiki-staging'
              if os.path.exists('/srv/mediawiki-staging')
              else '/srv/mediawiki')
target_branch = '(\d+)' if len(sys.argv) == 1 else sys.argv[1]
branch_pattern = r'php-(\d+)\.(\d+)\.(\d+)-wmf\.' + target_branch + '$'
branch_version = []
branch_dirname = None

for node in os.listdir(search_dir):
    match = re.match(branch_pattern, node)
    if match:
        version = map(int, match.groups())
        if version > branch_version:
            branch_dirname = node
            branch_version = version

if branch_dirname:
    print(branch_dirname)
    sys.exit(0)
else:
    sys.exit(1)
