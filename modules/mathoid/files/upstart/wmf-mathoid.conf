#######################################################################
## WARNING: this file is managed by Puppet
## puppet:///files/wmf-mathoid.conf
########################################################################

description "TeX to MathML conversion mathematical formulae (with SVG fallback)"

author "Antoine Musso <hashar@free.fr>"

setuid mathoid

# start/stop based on ssh
start on filesystem or runlevel [2345]
stop on runlevel [!2345]

# Log to /var/log/upstart
console log

# Low priority is fine
nice 19
env DEFAULTFILE=/etc/default/wmf-mathoid

pre-start script
    # Better have the wrapping shell script
    test -x /vagrant/mediawiki/extensions/Math/mathoid/start.sh  || { stop; exit 0; }   
end script

script
    # Load default environnement
    if [ -f "$DEFAULTFILE" ]; then
    . "$DEFAULTFILE"
    fi

    exec /usr/bin/env /usr/local/bin/Math/mathoid/start.sh  2>&1 1>> /var/log/wmf-mathoid.log
end script
