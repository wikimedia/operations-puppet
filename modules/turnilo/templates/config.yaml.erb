# generated by Turnilo version 1.4.1
# for a more detailed walk-through go to: https://github.com/allegro/turnilo/blob/1.4.1/docs/configuration.md

# The port on which the server will listen on
port:  <%= @port %>

clusters:
<% @druid_clusters.each do |cluster| -%>
-
<% cluster.keys.sort.each do |key| -%>
  <%= key %>: <%= cluster[key] %>
<% end # cluster.keys.each -%>

<% end # @druid_clusters.each -%>

trustProxy: always
customization:
  # the shortner fails if it sees a port in the url, so the regex below is not quite perfect
  urlShortener: |
    const req = {
      url: 'https://api-rw.discovery.wmnet/w/api.php?format=json&action=shortenurl',
      proxy: 'http://webproxy.eqiad.wmnet:8080',
      form: { url: url.replace(/localhost[:0-9]*/, 'turnilo.wikimedia.org') },
      headers: {
        'Host': 'meta.wikimedia.org',
        'X-Forwarded-For': context.clientIp,
      },
      json: true,
    };
    return request.post(req).then(x => x.error ? x.error.info : x.shortenurl.shorturl);

dataCubes:
  - name: mediawiki_geoeditors_monthly
    title: mediawiki_geoeditors_monthly
    clusterName: druid-analytics-eqiad
    description: Editors per project per country per month.
    source: mediawiki_geoeditors_monthly
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    defaultDuration: P1M # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: distinct_editors

    # The names of measures that are selected by default
    defaultSelectedMeasures: [distinct_editors]

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    defaultPinnedDimensions: [wiki_db]

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time
        granularities: ["P1M","P1M", "P1M", "P1M","P1M"]

      - name: activity_level
        title: Activity Level
        formula: $activity_level

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: users_are_anonymous
        title: Users Are Anonymous
        formula: $users_are_anonymous

      - name: wiki_db
        title: Wiki Db
        formula: $wiki_db

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: distinct_editors
        title: Distinct Editors
        formula: $main.sum($distinct_editors)

      - name: namespace_zero_distinct_editors
        title: Namespace Zero Distinct Editors
        formula: $main.sum($namespace_zero_distinct_editors)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: pageviews_daily
    title: pageviews_daily
    clusterName: druid-analytics-eqiad
    description: Pageview data agreggated daily for all projects per country.
    source: pageviews_daily
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: access_method
        title: Access Method
        formula: $access_method

      - name: agent_type
        title: Agent Type
        formula: $agent_type

      - name: continent
        title: Continent
        formula: $continent

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: language_variant
        title: Language Variant
        formula: $language_variant

      - name: project_family
        title: Project Family
        formula: $project_family

      - name: project
        title: Project
        formula: $project

      - name: namespace_is_content
        title: Namespace is Content
        formula: $namespace_is_content

      - name: namespace_is_talk
        title: Namespace is Talk
        formula: $namespace_is_talk

      - name: namespace_canonical_name
        title: Namespace Canonical Name
        formula: $namespace_canonical_name

      - name: referer_class
        title: Referer Class
        formula: $referer_class

      - name: ua_browser_family
        title: Ua Browser Family
        formula: $ua_browser_family

      - name: ua_browser_major
        title: Ua Browser Major
        formula: $ua_browser_major

      - name: ua_os_family
        title: Ua Os Family
        formula: $ua_os_family

      - name: ua_os_major
        title: Ua Os Major
        formula: $ua_os_major

      - name: ua_os_minor
        title: Ua Os Minor
        formula: $ua_os_minor

      - name: ua_wmf_app_version
        title: Ua Wmf App Version
        formula: $ua_wmf_app_version

      - name: zero_carrier
        title: Zero Carrier
        formula: $zero_carrier

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: view_count
        title: View Count
        formula: $main.sum($view_count)

      - name: percentage_of_bots_requests
        title: Percentage of identified bot requests
        formula: $main.filter($agent_type=="spider" or $agent_type =="automated").sum($view_count)/$main.sum($view_count)* 100

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: mediawiki_history_beta
    title: mediawiki_history_beta
    clusterName: druid-analytics-eqiad
    source: mediawiki_history_beta
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query

    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: anonymous_event_users

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: event_entity
        title: Event Entity
        formula: $event_entity

      - name: event_type
        title: Event Type
        formula: $event_type

      - name: event_user_blocks
        title: Event User Blocks
        formula: $event_user_blocks

      - name: event_user_blocks_historical
        title: Event User Blocks Historical
        formula: $event_user_blocks_historical

      - name: event_user_creation_timestamp
        title: Event User Creation Timestamp
        formula: $event_user_creation_timestamp

      - name: event_user_groups
        title: Event User Groups
        formula: $event_user_groups

      - name: event_user_groups_historical
        title: Event User Groups Historical
        formula: $event_user_groups_historical

      - name: event_user_id
        title: Event User Id
        formula: $event_user_id

      - name: event_user_is_anonymous
        title: Event User Is Anonymous
        formula: $event_user_is_anonymous

      - name: event_user_is_bot_by_name
        title: Event User Is Bot By Name
        formula: $event_user_is_bot_by_name

      - name: event_user_is_created_by_peer
        title: Event User Is Created By Peer
        formula: $event_user_is_created_by_peer

      - name: event_user_is_created_by_self
        title: Event User Is Created By Self
        formula: $event_user_is_created_by_self

      - name: event_user_is_created_by_system
        title: Event User Is Created By System
        formula: $event_user_is_created_by_system

      - name: event_user_revision_count
        title: Event User Revision Count
        formula: $event_user_revision_count

      - name: event_user_seconds_since_previous_revision
        title: Event User Seconds Since Previous Revision
        formula: $event_user_seconds_since_previous_revision

      - name: event_user_text
        title: Event User Text
        formula: $event_user_text

      - name: event_user_text_historical
        title: Event User Text Historical
        formula: $event_user_text_historical

      - name: page_creation_timestamp
        title: Page Creation Timestamp
        formula: $page_creation_timestamp

      - name: page_id
        title: Page Id
        formula: $page_id

      - name: page_is_redirect
        title: Page Is Redirect
        formula: $page_is_redirect

      - name: page_namespace
        title: Page Namespace
        formula: $page_namespace

      - name: page_namespace_historical
        title: Page Namespace Historical
        formula: $page_namespace_historical

      - name: page_namespace_is_content
        title: Page Namespace Is Content
        formula: $page_namespace_is_content

      - name: page_namespace_is_content_historical
        title: Page Namespace Is Content Historical
        formula: $page_namespace_is_content_historical

      - name: page_revision_count
        title: Page Revision Count
        formula: $page_revision_count

      - name: page_seconds_since_previous_revision
        title: Page Seconds Since Previous Revision
        formula: $page_seconds_since_previous_revision

      - name: page_title
        title: Page Title
        formula: $page_title

      - name: page_title_historical
        title: Page Title Historical
        formula: $page_title_historical

      - name: revision_content_format
        title: Revision Content Format
        formula: $revision_content_format

      - name: revision_content_model
        title: Revision Content Model
        formula: $revision_content_model

      - name: revision_deleted_timestamp
        title: Revision Deleted Timestamp
        formula: $revision_deleted_timestamp

      - name: revision_first_identity_reverting_revision_id
        title: Revision First Identity Reverting Revision Id
        formula: $revision_first_identity_reverting_revision_id

      - name: revision_id
        title: Revision Id
        formula: $revision_id

      - name: revision_is_deleted
        title: Revision Is Deleted
        formula: $revision_is_deleted

      - name: revision_is_identity_revert
        title: Revision Is Identity Revert
        formula: $revision_is_identity_revert

      - name: revision_is_identity_reverted
        title: Revision Is Identity Reverted
        formula: $revision_is_identity_reverted

      - name: revision_minor_edit
        title: Revision Minor Edit
        formula: $revision_minor_edit

      - name: revision_parent_id
        title: Revision Parent Id
        formula: $revision_parent_id

      - name: revision_seconds_to_identity_revert
        title: Revision Seconds To Identity Revert
        formula: $revision_seconds_to_identity_revert

      - name: revision_text_bytes
        title: Revision Text Bytes
        formula: $revision_text_bytes

      - name: revision_text_bytes_diff
        title: Revision Text Bytes Diff
        formula: $revision_text_bytes_diff

      - name: revision_text_sha1
        title: Revision Text Sha1
        formula: $revision_text_sha1

      - name: user_blocks
        title: User Blocks
        formula: $user_blocks

      - name: user_blocks_historical
        title: User Blocks Historical
        formula: $user_blocks_historical

      - name: user_creation_timestamp
        title: User Creation Timestamp
        formula: $user_creation_timestamp

      - name: user_groups
        title: User Groups
        formula: $user_groups

      - name: user_groups_historical
        title: User Groups Historical
        formula: $user_groups_historical

      - name: user_id
        title: User Id
        formula: $user_id

      - name: user_is_anonymous
        title: User Is Anonymous
        formula: $user_is_anonymous

      - name: user_is_bot_by_name
        title: User Is Bot By Name
        formula: $user_is_bot_by_name

      - name: user_is_created_by_peer
        title: User Is Created By Peer
        formula: $user_is_created_by_peer

      - name: user_is_created_by_self
        title: User Is Created By Self
        formula: $user_is_created_by_self

      - name: user_is_created_by_system
        title: User Is Created By System
        formula: $user_is_created_by_system

      - name: user_text
        title: User Text
        formula: $user_text

      - name: user_text_historical
        title: User Text Historical
        formula: $user_text_historical

      - name: wiki_db
        title: Wiki Db
        formula: $wiki_db

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: anonymous_event_users
        title: Anonymous Event Users
        formula: $main.sum($anonymous_event_users)

      - name: anonymous_users
        title: Anonymous Users
        formula: $main.sum($anonymous_users)

      - name: bot_by_name_event_users
        title: Bot By Name Event Users
        formula: $main.sum($bot_by_name_event_users)

      - name: bot_by_name_users
        title: Bot By Name Users
        formula: $main.sum($bot_by_name_users)

      - name: content_namespace_pages
        title: Content Namespace Pages
        formula: $main.sum($content_namespace_pages)

      - name: content_namespace_pages_historical
        title: Content Namespace Pages Historical
        formula: $main.sum($content_namespace_pages_historical)

      - name: deleted_revisions
        title: Deleted Revisions
        formula: $main.sum($deleted_revisions)

      - name: events
        title: Events
        formula: $main.sum($events)

      - name: identity_reverted_revisions
        title: Identity Reverted Revisions
        formula: $main.sum($identity_reverted_revisions)

      - name: identity_reverting_revisions
        title: Identity Reverting Revisions
        formula: $main.sum($identity_reverting_revisions)

      - name: minor_revisions
        title: Minor Revisions
        formula: $main.sum($minor_revisions)

      - name: peer_created_event_users
        title: Peer Created Event Users
        formula: $main.sum($peer_created_event_users)

      - name: peer_created_users
        title: Peer Created Users
        formula: $main.sum($peer_created_users)

      - name: redirect_pages
        title: Redirect Pages
        formula: $main.sum($redirect_pages)

      - name: revision_text_bytes_diff_num
        title: Revision Text Bytes Diff Num
        formula: $main.sum($revision_text_bytes_diff_num)

      - name: revision_text_bytes_num
        title: Revision Text Bytes Num
        formula: $main.sum($revision_text_bytes_num)

      - name: self_created_event_users
        title: Self Created Event Users
        formula: $main.sum($self_created_event_users)

      - name: self_created_users
        title: Self Created Users
        formula: $main.sum($self_created_users)

      - name: system_created_event_users
        title: System Created Event Users
        formula: $main.sum($system_created_event_users)

      - name: system_created_users
        title: System Created Users
        formula: $main.sum($system_created_users)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: banner_activity_minutely
    title: banner_activity_minutely
    clusterName: druid-analytics-eqiad
    description: Impressions of banners per campaign on all projects.
    source: banner_activity_minutely
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: request_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: anonymous
        title: Anonymous
        formula: $anonymous

      - name: banner
        title: Banner
        formula: $banner

      - name: bucket
        title: Bucket
        formula: $bucket

      - name: campaign
        title: Campaign
        formula: $campaign

      - name: country
        title: Country
        formula: $country

      - name: country_matches_geocode
        title: Country Matches Geocode
        formula: $country_matches_geocode

      - name: device
        title: Device
        formula: $device

      - name: project
        title: Project
        formula: $project

      - name: region
        title: Region
        formula: $region

      - name: sample_rate
        title: Sample Rate
        formula: $sample_rate

      - name: status_code
        title: Status Code
        formula: $status_code

      - name: uselang
        title: Uselang
        formula: $uselang

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: request_count
        title: Request Count
        formula: $main.sum($request_count)

      - name: normalized_request_count
        title: Normalized Request Count
        formula: $main.sum($normalized_request_count)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: unique_devices_per_domain_monthly
    title: unique_devices_per_domain_monthly
    description: Unique Devices per mobile and desktop sites per project. Metric is not additive across sites or projects.
    clusterName: druid-analytics-eqiad
    source: unique_devices_per_domain_monthly
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    defaultDuration: P1M # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: uniques_estimate

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    defaultPinnedDimensions: [domain]

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time
        granularities: ["P1M","P1M", "P1M", "P1M","P1M"]

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: domain
        title: Domain
        formula: $domain

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: uniques_estimate
        title: Uniques Estimate
        formula: $main.sum($uniques_estimate)

      - name: uniques_offset
        title: Uniques Offset
        formula: $main.sum($uniques_offset)

      - name: uniques_underestimate
        title: Uniques Underestimate
        formula: $main.sum($uniques_underestimate)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: unique_devices_per_project_family_daily
    title: unique_devices_per_project_family_daily
    clusterName: druid-analytics-eqiad
    description: Unique Devices per project family (all *.wikipedia.org sites, for example).
    source: unique_devices_per_project_family_daily
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: uniques_estimate

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    defaultPinnedDimensions: [project_family]

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: project_family
        title: Project Family
        formula: $project_family

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: uniques_estimate
        title: Uniques Estimate
        formula: $main.sum($uniques_estimate)

      - name: uniques_offset
        title: Uniques Offset
        formula: $main.sum($uniques_offset)

      - name: uniques_underestimate
        title: Uniques Underestimate
        formula: $main.sum($uniques_underestimate)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: unique_devices_per_domain_daily
    title: unique_devices_per_domain_daily
    description: Unique Devices per mobile and desktop sites per project. Metric is not additive across sites or projects.
    clusterName: druid-analytics-eqiad
    source: unique_devices_per_domain_daily
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: uniques_estimate

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    defaultPinnedDimensions: [domain]

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: domain
        title: Domain
        formula: $domain

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: uniques_estimate
        title: Uniques Estimate
        formula: $main.sum($uniques_estimate)

      - name: uniques_offset
        title: Uniques Offset
        formula: $main.sum($uniques_offset)

      - name: uniques_underestimate
        title: Uniques Underestimate
        formula: $main.sum($uniques_underestimate)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: pageviews_hourly
    title: pageviews_hourly
    clusterName: druid-analytics-eqiad
    description: Pageview data for all projects per country per browser, agreggated hourly for the last 3 months.
    source: pageviews_hourly
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: access_method
        title: Access Method
        formula: $access_method

      - name: agent_type
        title: Agent Type
        formula: $agent_type

      - name: city
        title: City
        formula: $city

      - name: continent
        title: Continent
        formula: $continent

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: language_variant
        title: Language Variant
        formula: $language_variant

      - name: project_family
        title: Project Family
        formula: $project_family

      - name: project
        title: Project
        formula: $project

      - name: namespace_is_content
        title: Namespace is Content
        formula: $namespace_is_content

      - name: namespace_is_talk
        title: Namespace is Talk
        formula: $namespace_is_talk

      - name: namespace_canonical_name
        title: Namespace Canonical Name
        formula: $namespace_canonical_name

      - name: referer_class
        title: Referer Class
        formula: $referer_class

      - name: subdivision
        title: Subdivision
        formula: $subdivision

      - name: ua_browser_family
        title: Ua Browser Family
        formula: $ua_browser_family

      - name: ua_browser_major
        title: Ua Browser Major
        formula: $ua_browser_major

      - name: ua_device_family
        title: Ua Device Family
        formula: $ua_device_family

      - name: ua_os_family
        title: Ua Os Family
        formula: $ua_os_family

      - name: ua_os_major
        title: Ua Os Major
        formula: $ua_os_major

      - name: ua_os_minor
        title: Ua Os Minor
        formula: $ua_os_minor

      - name: ua_wmf_app_version
        title: Ua Wmf App Version
        formula: $ua_wmf_app_version

      - name: zero_carrier
        title: Zero Carrier
        formula: $zero_carrier

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: view_count
        title: View Count
        formula: $main.sum($view_count)

      - name: percentage_of_bots_requests
        title: Percentage of idenfied bot requests
        formula: $main.filter($agent_type=="spider" or $agent_type=="automated").sum($view_count)/$main.sum($view_count)* 100

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: unique_devices_per_project_family_monthly
    title: unique_devices_per_project_family_monthly
    description: Unique Devices per project family (all *.wikipedia.org sites, for example).
    clusterName: druid-analytics-eqiad
    source: unique_devices_per_project_family_monthly
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    defaultDuration: P1M # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: uniques_estimate

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    defaultPinnedDimensions: [project_family]

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time
        granularities: ["P1M","P1M", "P1M", "P1M","P1M"]

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: project_family
        title: Project Family
        formula: $project_family

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: uniques_estimate
        title: Uniques Estimate
        formula: $main.sum($uniques_estimate)

      - name: uniques_offset
        title: Uniques Offset
        formula: $main.sum($uniques_offset)

      - name: uniques_underestimate
        title: Uniques Underestimate
        formula: $main.sum($uniques_underestimate)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: virtualpageviews_hourly
    title: virtualpageviews_hourly
    description: Previews per hour per project per country.
    clusterName: druid-analytics-eqiad
    source: virtualpageviews_hourly
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: view_count

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute


    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: access_method
        title: Access Method
        formula: $access_method

      - name: agent_type
        title: Agent Type
        formula: $agent_type

      - name: city
        title: City
        formula: $city

      - name: continent
        title: Continent
        formula: $continent

      - name: country
        title: Country
        formula: $country

      - name: country_code
        title: Country Code
        formula: $country_code

      - name: language_variant
        title: Language Variant
        formula: $language_variant

      - name: project
        title: Project
        formula: $project

      - name: referer_class
        title: Referer Class
        formula: $referer_class

      - name: subdivision
        title: Subdivision
        formula: $subdivision

      - name: ua_browser_family
        title: Ua Browser Family
        formula: $ua_browser_family

      - name: ua_browser_major
        title: Ua Browser Major
        formula: $ua_browser_major

      - name: ua_device_family
        title: Ua Device Family
        formula: $ua_device_family

      - name: ua_os_family
        title: Ua Os Family
        formula: $ua_os_family

      - name: ua_os_major
        title: Ua Os Major
        formula: $ua_os_major

      - name: ua_os_minor
        title: Ua Os Minor
        formula: $ua_os_minor

      - name: ua_wmf_app_version
        title: Ua Wmf App Version
        formula: $ua_wmf_app_version

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: view_count
        title: View Count
        formula: $main.sum($view_count)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: webrequest_sampled_live
    title: webrequest_sampled_live
    description: All web requests received for all projects sampled to 1/128.
    clusterName: druid-analytics-eqiad
    source: webrequest_sampled_live
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: hits

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute

      # see: https://github.com/allegro/turnilo/blob/master/docs/configuration.md#custom-transformations
      # these dimensions are going to be read as strings unless we say otherwise

      - name: response_size
        type: NUMBER

      - name: time_firstbyte
        type: NUMBER

    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: content_type
        title: Content Type
        formula: $content_type

      - name: hostname
        title: Hostname
        formula: $hostname

      - name: http_method
        title: Http Method
        formula: $http_method

      - name: http_status
        title: Http Status
        formula: $http_status

      - name: ip
        title: Ip
        formula: $ip

      - name: referer
        title: Referer
        formula: $referer

      - name: response_size
        title: Response Size
        kind: number
        formula: $response_size

      - name: time_firstbyte
        title: Time Firstbyte
        kind: number
        formula: $time_firstbyte

      - name: uri_host
        title: Uri Host
        formula: $uri_host

      - name: uri_path
        title: Uri Path
        formula: $uri_path

      - name: uri_query
        title: Uri Query
        formula: $uri_query

      - name: user_agent
        title: User Agent
        formula: $user_agent

      - name: webrequest_source
        title: Webrequest Source
        formula: $webrequest_source

      - name: x_cache
        title: X Cache
        formula: $x_cache

      - name: client_port
        title: Client source port
        formula: $client_port

      - name: is_debug
        title: X-Analytics is debug
        formula: $is_debug

      - name: as_number
        title: AS number
        formula: $as_number

      - name: isp
        title: ISP
        formula: $isp

      - name: continent
        title: Continent
        formula: $continent

      - name: country_code
        title: Country code
        formula: $country_code

      - name: is_pageview
        title: Is pageview
        formula: $is_pageview

      - name: tls_version
        title: TLS Version
        formula: $tls_version

      - name: tls_key_exchange
        title: TLS KeyExchange
        formula: $tls_key_exchange

      - name: tls_auth
        title: TLS Auth
        formula: $tls_auth

      - name: tls_cipher
        title: TLS Cipher
        formula: $tls_cipher

      - name: is_from_public_cloud
        title: Is from public cloud
        formula: $is_from_public_cloud

      - name: requestctl
        title: X-Analytics requestctl actions
        formula: $requestctl

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: hits
        title: Hits
        formula: $main.sum($hits)

      - name: aggregated_response_size
        title: Aggregated Response Size
        formula: $main.sum($aggregated_response_size)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  - name: webrequest_sampled_128
    title: webrequest_sampled_128
    description: All web requests received for all projects sampled to 1/128.
    clusterName: druid-analytics-eqiad
    source: webrequest_sampled_128
    # The refresh rule describes how often the data cube looks for new data. Default: 'query'/PT1M (every minute)
    refreshRule:
      rule: query


    #defaultTimezone: Etc/UTC # <- default
    #defaultDuration: P1D # <- default

    # The name of the measure that will be used for default sorting.
    # It is commonly set to the measure that represents the count of events.
    # Default: the first measure.
    defaultSortMeasure: hits

    # The names of measures that are selected by default
    #defaultSelectedMeasures: []

    # The names of dimensions that are pinned by default (in order that they will appear in the pin bar)

    #defaultPinnedDimensions: []

    # How the dataset should be introspected
    # possible options are:
    # * none - Do not do any introspection, take what is written in the config as the rule of law.
    # * no-autofill - Introspect the datasource but do not automatically generate dimensions or measures
    # * autofill-dimensions-only - Introspect the datasource, automatically generate dimensions only
    # * autofill-measures-only - Introspect the datasource, automatically generate measures only
    # * autofill-all - (default) Introspect the datasource, automatically generate dimensions and measures
    introspection: none

    # The list of attribute overrides in case introspection get something wrong
    attributeOverrides:
      # A general attribute override looks like so:
      #
      # name: user_unique
      # ^ the name of the attribute (the column in the database)
      #
      # type: STRING
      # ^ (optional) plywood type of the attribute
      #
      # special: unique
      # ^ (optional) any kind of special significance associated with this attribute

      # see: https://github.com/allegro/turnilo/blob/master/docs/configuration.md#custom-transformations
      # these dimensions are going to be read as strings unless we say otherwise

      - name: response_size
        type: NUMBER

      - name: time_firstbyte
        type: NUMBER

    # The list of dimensions defined in the UI. The order here will be reflected in the UI
    dimensions:
      # A general dimension looks like so:
      #
      # name: channel
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: The Channel
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # kind: string
      # ^ (optional) the kind of the dimension. Can be 'string', 'time', 'number', or 'boolean'. Defaults to 'string'
      #
      # formula: $channel
      # ^ (optional) the Plywood bucketing expression for this dimension. Defaults to '$name'
      #   if, say, channel was called 'cnl' in the data you would put '$cnl' here
      #   See also the expressions API reference: https://plywood.imply.io/expressions
      #
      # url: string
      # ^ (optional) a url (including protocol) associated with the dimension, with optional token '%s'
      #   that is replaced by the dimension value to generate links specific to each value.

      - name: __time
        title: Time
        kind: time
        formula: $__time

      - name: content_type
        title: Content Type
        formula: $content_type

      - name: hostname
        title: Hostname
        formula: $hostname

      - name: http_method
        title: Http Method
        formula: $http_method

      - name: http_status
        title: Http Status
        formula: $http_status

      - name: ip
        title: Ip
        formula: $ip

      - name: referer
        title: Referer
        formula: $referer

      - name: response_size
        title: Response Size
        kind: number
        formula: $response_size

      - name: time_firstbyte
        title: Time Firstbyte
        kind: number
        formula: $time_firstbyte

      - name: uri_host
        title: Uri Host
        formula: $uri_host

      - name: uri_path
        title: Uri Path
        formula: $uri_path

      - name: uri_query
        title: Uri Query
        formula: $uri_query

      - name: user_agent
        title: User Agent
        formula: $user_agent

      - name: webrequest_source
        title: Webrequest Source
        formula: $webrequest_source

      - name: x_cache
        title: X Cache
        formula: $x_cache

      - name: client_port
        title: Client source port
        formula: $client_port

      - name: is_debug
        title: X-Analytics is debug
        formula: $is_debug

      - name: as_number
        title: AS number
        formula: $as_number

      - name: isp
        title: ISP
        formula: $isp

      - name: continent
        title: Continent
        formula: $continent

      - name: country_code
        title: Country code
        formula: $country_code

      - name: is_pageview
        title: Is pageview
        formula: $is_pageview

      - name: tls_version
        title: TLS Version
        formula: $tls_version

      - name: tls_key_exchange
        title: TLS KeyExchange
        formula: $tls_key_exchange

      - name: tls_auth
        title: TLS Auth
        formula: $tls_auth

      - name: tls_cipher
        title: TLS Cipher
        formula: $tls_cipher

      - name: is_from_public_cloud
        title: Is from public cloud
        formula: $is_from_public_cloud

      - name: requestctl
        title: X-Analytics requestctl actions
        formula: $requestctl

      # This is the place where you might want to add derived dimensions.
      #
      # Here are some examples of possible derived dimensions:
      #
      # - name: is_usa
      #   title: Is USA?
      #   formula: $country == 'United States'
      #
      # - name: file_version
      #   formula: $filename.extract('(\d+\.\d+\.\d+)')


    # The list of measures defined in the UI. The order here will be reflected in the UI
    measures:
      # A general measure looks like so:
      #
      # name: avg_revenue
      # ^ the name of the dimension as used in the URL (you should try not to change these)
      #
      # title: Average Revenue
      # ^ (optional) the human readable title. If not set a title is generated from the 'name'
      #
      # formula: $main.sum($revenue) / $main.sum($volume) * 10
      # ^ (optional) the Plywood bucketing expression for this dimension.
      #   Usually defaults to '$main.sum($name)' but if the name contains 'min' or 'max' will use that as the aggregate instead of sum.
      #   this is the place to define your fancy formulas

      - name: hits
        title: Hits
        formula: $main.sum($hits)

      - name: aggregated_response_size
        title: Aggregated Response Size
        formula: $main.sum($aggregated_response_size)

      # This is the place where you might want to add derived measures (a.k.a Post Aggregators).
      #
      # Here are some examples of possible derived measures:
      #
      # - name: ecpm
      #   title: eCPM
      #   formula: $main.sum($revenue) / $main.sum($impressions) * 1000
      #
      # - name: usa_revenue
      #   title: USA Revenue
      #   formula: $main.filter($country == 'United States').sum($revenue)


  # Edits hourly data set
  - name: edits_hourly
    title: edits_hourly
    source: edits_hourly
    description: Hourly cube for Wikimedia editing stats.
    clusterName: druid-analytics-eqiad
    introspection: autofill-dimensions-only
    measures:
      - name: count
        title: Edit Count
        formula: $main.sum($edit_count)
      - name: text_bytes_diff
        title: Text Bytes Diff
        formula: $main.sum($text_bytes_diff)


  # Netflow data
  - name: wmf_netflow
    title: wmf_netflow
    clusterName: druid-analytics-eqiad
    source: wmf_netflow
    description: Network data
    defaultSortMeasure: packets
    introspection: none
    options:
      customTransforms:
        direction:
          extractionFn:
            type: lookup
            retainMissingValue: true
            lookup:
              type: map
              map: {"1":"inbound", "2":"outbound","0":"unknown"}
        tcp:
          extractionFn:
            type: lookup
            retainMissingValue: true
            lookup:
              type: map
              # see P13050 for how this list was generated
              map:
                "1": "FIN"
                "2": "SYN"
                "3": "SYN+FIN"
                "4": "RST"
                "5": "RST+FIN"
                "6": "RST+SYN"
                "7": "RST+SYN+FIN"
                "8": "PSH"
                "9": "PSH+FIN"
                "10": "PSH+SYN"
                "12": "PSH+RST"
                "15": "PSH+RST+SYN+FIN"
                "16": "ACK"
                "17": "ACK+FIN"
                "18": "ACK+SYN"
                "19": "ACK+SYN+FIN"
                "20": "ACK+RST"
                "21": "ACK+RST+FIN"
                "22": "ACK+RST+SYN"
                "23": "ACK+RST+SYN+FIN"
                "24": "ACK+PSH"
                "25": "ACK+PSH+FIN"
                "26": "ACK+PSH+SYN"
                "27": "ACK+PSH+SYN+FIN"
                "28": "ACK+PSH+RST"
                "29": "ACK+PSH+RST+FIN"
                "30": "ACK+PSH+RST+SYN"
                "31": "ACK+PSH+RST+SYN+FIN"
                "32": "URG"
                "33": "URG+FIN"
                "34": "URG+SYN"
                "35": "URG+SYN+FIN"
                "36": "URG+RST"
                "37": "URG+RST+FIN"
                "40": "URG+PSH"
                "42": "URG+PSH+SYN"
                "43": "URG+PSH+SYN+FIN"
                "44": "URG+PSH+RST"
                "45": "URG+PSH+RST+FIN"
                "48": "URG+ACK"
                "49": "URG+ACK+FIN"
                "50": "URG+ACK+SYN"
                "51": "URG+ACK+SYN+FIN"
                "52": "URG+ACK+RST"
                "54": "URG+ACK+RST+SYN"
                "56": "URG+ACK+PSH"
                "57": "URG+ACK+PSH+FIN"
                "58": "URG+ACK+PSH+SYN"
                "59": "URG+ACK+PSH+SYN+FIN"
<%- unless @export_names_map.empty? -%>
        exporter_name_map:
          extractionFn:
            type: lookup
            retainMissingValue: true
            lookup:
              type: map
              isOneToOne: true
              map:
  <%- @export_names_map.each_pair do |ip, name| -%>
                "<%= ip %>" : "<%= name %>"
  <%- end -%>
<%- end -%>
<%- unless @export_names_map.empty? -%>
        exporter_region_map:
          extractionFn:
            type: lookup
            retainMissingValue: true
            lookup:
              type: map
              isOneToOne: false
              map:
  <%- @export_names_map.each_pair do |ip, name| -%>
                "<%= ip %>" : "<%= name[-3..-1] %>"
  <%- end -%>
<%- end -%>
    dimensions:
       - name: as_src
         title: AS src
         formula: $as_src
       - name: as_dst
         title: AS dst
         formula: $as_dst
       - name: as_path
         title: AS path
         formula: $as_path
       - name: ip_src
         title: IP src
         formula: $ip_src
       - name: ip_dst
         title: IP dst
         formula: $ip_dst
       - name: ip_proto
         title: IP proto
         formula: $ip_proto
       - name: peer_as_src
         title: Peer AS src
         formula: $peer_as_src
       - name: peer_as_dst
         title: Peer AS dst
         formula: $peer_as_dst
       - name: port_src
         title: Port src
         formula: $port_src
       - name: port_dst
         title: Port dst
         formula: $port_dst
       - name: country_ip_src
         title: Country IP src
         formula: $country_ip_src
       - name: country_ip_dst
         title: Country IP dst
         formula: $country_ip_dst
       - name: tag2
         title: Direction
         formula: $tag2.customTransform('direction')
       - name: tcp_flags
         title: TCP flags
         formula: $tcp_flags.customTransform('tcp')
<%- unless @export_names_map.empty? -%>
       - name: exporter_name
         title: Exporter name
         formula: $peer_ip_src.customTransform('exporter_name_map')
<%- end -%>
<%- unless @export_names_map.empty? -%>
       - name: exporter_region
         title: Exporter Region
         formula: $peer_ip_src.customTransform('exporter_region_map')
<%- end -%>
       - name: parsed_comms
         title: Parsed Comms
         formula: $parsed_comms
       - name: net_cidr_src
         title: Net CIDR src
         formula: $net_cidr_src
       - name: net_cidr_dst
         title: Net CIDR dst
         formula: $net_cidr_dst
       - name: as_name_src
         title: AS name src
         formula: $as_name_src
       - name: as_name_dst
         title: AS name dst
         formula: $as_name_dst
       - name: ip_version
         title: IP version
         formula: $ip_version
       - name: region
         title: Region
         formula: $region
    defaultSelectedMeasures: [bps, pps]
    measures:
       - name: bytes
         title: Bytes
         formula: $main.sum($bytes)
         format: "0,0.00 b"
       - name: packets
         title: Packets
         formula: $main.sum($packets)
       - name: bps
         title: bps
         formula: $main.sum($bytes)*8 / ($MillisecondsInInterval / 1000)
       - name: pps
         title: pps
         formula: $main.sum($packets) / ($MillisecondsInInterval / 1000)
