# Serve HHVM status info on </hhvm-status> to internal clients.
# This file is managed by Puppet.

<LocationMatch "/hhvm-status/(.*)">
    ProxyPassMatch fcgi://127.0.0.1:9001/$1 retry=0
    <RequireAll>
        # Disallow proxied requests
        Require expr -z http('X-Forwarded-For') && -z http('X-Varnish')
        # Allow requests from internal and local IPs only
        <RequireAny>
            Require ip 10. <%= scope['::network::constants::all_networks'].join(' ') %>
            Require local
        </RequireAny>
    </RequireAll>
</LocationMatch>

# vim: ft=apache.erb:
