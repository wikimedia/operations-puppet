<?xml version="1.0" encoding="UTF-8"?>

<configuration>
	<creator-info>
		Written by Mark Bergsma &lt;mark@nedworks.org&gt;
	</creator-info>
	
	<datasources>
		<param name="expr-Squid_text_pmtpa">	{/Squids/pmtpa/text/sq16.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq17.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq18.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq19.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq20.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq21.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq22.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq23.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq24.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq25.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq26.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq27.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq28.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq29.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq30.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq31.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq32.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq33.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq34.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq35.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq36.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq37.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq38.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq39.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq40.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq59.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq60.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq61.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq62.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq63.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq64.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq65.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq66.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq71.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq72.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq73.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq74.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq75.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq76.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq77.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq78.wikimedia.org/%squidlayer%/%squidmetric%},%sumsep%%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%
		</param>
		
		<param name="expr-Squid_api_pmtpa">
{/Squids/pmtpa/text/sq31.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq32.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/text/sq32.wikimedia.org/%squidlayer%/%squidmetric%},%sumsep%%sumfunc%,%sumfunc%
		</param>

		<param name="expr-Squid_upload_pmtpa">	{/Squids/pmtpa/upload/sq1.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq2.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq3.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq4.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq5.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq6.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq7.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq8.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq9.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq10.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq11.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq12.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq13.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq14.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq15.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq41.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq42.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq43.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq44.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq45.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq46.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq47.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq48.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq49.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq50.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq51.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq52.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq53.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq54.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq55.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq56.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq57.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq58.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq79.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq80.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq81.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq82.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq83.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq84.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq85.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/pmtpa/upload/sq86.wikimedia.org/%squidlayer%/%squidmetric%},%sumsep%%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%
		</param>

		<param name="expr-Squid_text_eqiad">
{/Squids/eqiad/text/cp1001.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1002.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1003.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1004.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1005.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1006.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1007.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1008.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1009.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1010.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1011.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1012.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1013.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1014.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1015.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1016.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1017.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1018.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/eqiad/text/cp1019.wikimedia.org/%squidlayer%/%squidmetric%},%sumsep%%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%
		</param>

		<param name="expr-Squid_text_esams">
{/Squids/esams/text/knsq1.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq2.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq3.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq4.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq5.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq6.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq7.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq23.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq24.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq25.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq26.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq27.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq28.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq29.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/knsq30.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq31.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq32.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq33.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq34.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq35.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq36.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq37.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq38.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq39.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq40.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq41.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq42.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq43.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq44.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq45.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/text/amssq46.esams.wikimedia.org/%squidlayer%/%squidmetric%},%sumsep%%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%
		</param>

		<param name="expr-Squid_upload_esams">	{/Squids/esams/upload/knsq8.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq9.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq10.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq11.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq12.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq13.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq14.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq15.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq16.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq17.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq18.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq19.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq20.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq21.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/knsq22.knams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq47.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq48.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq49.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq50.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq51.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq52.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq53.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq54.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq55.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq56.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq57.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq58.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq59.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq60.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq61.esams.wikimedia.org/%squidlayer%/%squidmetric%},{/Squids/esams/upload/amssq62.esams.wikimedia.org/%squidlayer%/%squidmetric%},%sumsep%%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%,%sumfunc%
		</param>
		
		<param name="expr-Varnish_bits_pmtpa"> {/Varnish/pmtpa/bits/sq67.wikimedia.org/%varnishmetric%},{/Varnish/pmtpa/bits/sq68.wikimedia.org/%varnishmetric%},{/Varnish/pmtpa/bits/sq69.wikimedia.org/%varnishmetric%},{/Varnish/pmtpa/bits/sq70.wikimedia.org/%varnishmetric%},%sumsep%%sumfunc%,%sumfunc%,%sumfunc%
		</param>

		<param name="expr-Varnish_bits_eqiad">
{/Varnish/eqiad/bits/arsenic.wikimedia.org/%varnishmetric%},{/Varnish/eqiad/bits/niobium.wikimedia.org/%varnishmetric%},%sumsep%%sumfunc%
		</param>

		<param name="expr-Varnish_upload_eqiad">
<%
nodes = scope.lookupvar("role::cache::configuration::active_nodes")['upload']['eqiad']
nodes.each do |node| -%>{/Varnish/eqiad/upload/<%= node %>/%varnishmetric%},<% end -%>%sumsep%<%= (["%sumfunc%"]*(nodes.length? - 1)).join(",") %>
		</param>

		<param name="expr-Varnish_bits_esams">
{/Varnish/esams/bits/cp3001.esams.wikimedia.org/%varnishmetric%},{/Varnish/esams/bits/cp3002.esams.wikimedia.org/%varnishmetric%},%sumsep%%sumfunc%
		</param>

		<template name="squid-cluster">
			<param name="precedence" value="1000"/>
			<param name="ds-type" value="rrd-file"/>
			
			<leaf name="Client_requests">
				<param name="squidmetric" value="Usage/HTTP_requests"/>
				<param name="squidlayer" value="frontend"/>
				
				<param name="leaf-type" value="rrd-cdef"/>
				<param name="rpn-expr" value="%expr-Squid%"/>
				
				<param name="comment" value="All client requests"/>
				<param name="line-style" value="AREA"/>
				<param name="line-color" value="##%cluster%-%site%"/>
				<param name="precedence" value="1000"/>
			</leaf>
			
			<leaf name="Backend_requests">
				<param name="squidmetric" value="Usage/Server_side_HTTP_requests"/>
				<param name="squidlayer" value="backend"/>

				<param name="comment" value="All backend requests"/>
				<param name="vertical-label" value="requests/s"/>
				<param name="graph-lower-limit" value="0"/>
				<param name="leaf-type" value="rrd-cdef"/>
				<param name="rpn-expr" value="%expr-Squid%"/>
				<param name="graph-legend" value="%cluster%.%site%"/>
				<param name="line-style" value="LINE2"/>
				<param name="line-color" value="##%cluster%-%site%"/>
			</leaf>
			
			<leaf name="Service_times">
				
				<!-- count values -->
				<param name="sumsep" value = "1,"/>
				<param name="sumfunc" value="1,+"/>
				
				<param name="squidmetric" value="Service_times/Miss_HTTP_requests_service_time"/>
				<param name="squidlayer" value="backend"/>
				
				<param name="comment" value="Service times"/>
				<param name="vertical-label" value="seconds"/>
				<param name="graph-lower-limit" value="0"/>
				<param name="graph-upper-limit" value="0.3"/>
				<param name="rpn-expr" value="%expr-Squid%,AVG"/>
				<param name="leaf-type" value="rrd-cdef"/>
				<param name="graph-legend" value="%cluster%.%site%"/>
				<param name="line-style" value="LINE2"/>
				<param name="line-color" value="##%cluster%-%site%"/>
			</leaf>
		</template>
		
		<template name="varnish-cluster">
			<param name="ds-type" value="rrd-file"/>
			<param name="precedence" value="1000"/>
			
			<leaf name="Client_requests">
				<param name="varnishmetric" value="Clients/client_req"/>
		
				<param name="leaf-type" value="rrd-cdef"/>
				<param name="rpn-expr" value="%expr-Varnish%,0,1000000,LIMIT"/>
		
                <param name="line-style" value="AREA"/>
                <param name="line-color" value="##%cluster%-%site%"/>
			</leaf>
			
			<leaf name="Backend_requests">
				<param name="varnishmetric" value="Backends/backend_req"/>
				
				<param name="leaf-type" value="rrd-cdef"/>
				<param name="rpn-expr" value="%expr-Varnish%"/>
				
				<param name="line-style" value="LINE2"/>
				<param name="line-color" value="##%cluster%-%site%"/>
			</leaf>
		</template>

		<subtree name="Squids">
			<param name="sumfunc" value="ADDNAN"/>
			<param name="sumsep" value=""/>
			
			<subtree name="pmtpa">
				<param name="site" value="pmtpa"/>
				
				<subtree name="text">
					<param name="cluster" value="text"/>
					<param name="expr-Squid" value="%expr-Squid_text_pmtpa%"/>
					
					<subtree name="Totals">
						<apply-template name="squid-cluster"/>
					</subtree>
				</subtree>
				
				<subtree name="upload">
					<param name="cluster" value="upload"/>
					<param name="expr-Squid" value="%expr-Squid_upload_pmtpa%"/>
					
					<subtree name="Totals">
						<apply-template name="squid-cluster"/>
					</subtree>
				</subtree>
			</subtree>

			<subtree name="eqiad">
				<param name="site" value="eqiad"/>
				
				<subtree name="text">
					<param name="cluster" value="text"/>
					<param name="expr-Squid" value="%expr-Squid_text_eqiad%"/>
					
					<subtree name="Totals">
						<apply-template name="squid-cluster"/>
					</subtree>
				</subtree>
			</subtree>

			<subtree name="esams">
				<param name="site" value="esams"/>
				<subtree name="text">
					<param name="cluster" value="text"/>
					<param name="expr-Squid" value="%expr-Squid_text_esams%"/>
					
					<subtree name="Totals">
						<apply-template name="squid-cluster"/>
					</subtree>
				</subtree>
				
				<subtree name="upload">
					<param name="cluster" value="upload"/>
					<param name="expr-Squid" value="%expr-Squid_upload_esams%"/>
					
					<subtree name="Totals">
						<apply-template name="squid-cluster"/>
					</subtree>
				</subtree>
			</subtree>

			<subtree name="Totals">
				<param name="ds-type" value="rrd-file"/>
			
				<leaf name="All_squid_client_requests">
					<param name="squidmetric" value="Usage/HTTP_requests"/>
					<param name="squidlayer" value="frontend"/>
					
					<param name="ds-type" value="rrd-multigraph"/>
					<param name="ds-names" value="text-pmtpa,upload-pmtpa,text-esams,upload-esams,total"/>
					<param name="comment" value="Total client requests"/>
					<param name="vertical-label" value="requests/s"/>
					<param name="graph-lower-limit" value="0"/>
					
					<param name="ds-expr-text-pmtpa" value="%expr-Squid_text_pmtpa%"/>
					<param name="graph-legend-text-pmtpa" value="text.pmtpa"/>
                    <param name="line-style-text-pmtpa" value="STACK"/>
					<param name="line-stack-text-pmtpa" value="yes"/>
                    <param name="line-color-text-pmtpa" value="##text-pmtpa"/>
                    <param name="line-order-text-pmtpa" value="2"/>

					<param name="ds-expr-upload-pmtpa" value="%expr-Squid_upload_pmtpa%"/>
					<param name="graph-legend-upload-pmtpa" value="upload.pmtpa"/>
                    <param name="line-style-upload-pmtpa" value="AREA"/>
					<param name="line-stack-upload-pmtpa" value="no"/>
                    <param name="line-color-upload-pmtpa" value="##upload-pmtpa"/>
                    <param name="line-order-upload-pmtpa" value="1"/>

					<param name="ds-expr-text-esams" value="%expr-Squid_text_esams%"/>
					<param name="graph-legend-text-esams" value="text.esams"/>
                    <param name="line-style-text-esams" value="STACK"/>
					<param name="line-stack-text-esams" value="yes"/>
                    <param name="line-color-text-esams" value="##text-esams"/>
                    <param name="line-order-text-esams" value="4"/>

					<param name="ds-expr-upload-esams" value="%expr-Squid_upload_esams%"/>
					<param name="graph-legend-upload-esams" value="upload.esams"/>
                    <param name="line-style-upload-esams" value="STACK"/>
					<param name="line-stack-upload-esams" value="yes"/>
                    <param name="line-color-upload-esams" value="##upload-esams"/>
                    <param name="line-order-upload-esams" value="3"/>

					<param name="ds-expr-total" value="%expr-Squid_text_pmtpa%,%expr-Squid_upload_pmtpa%,%expr-Squid_text_esams%,%expr-Squid_upload_esams%,ADDNAN,ADDNAN,ADDNAN,0,1000000,LIMIT"/>
					<param name="graph-legend-total" value="Total"/>
                    <param name="line-style-total" value="LINE1"/>
					<param name="line-stack-total" value="no"/>
                    <param name="line-color-total" value="#000000"/>
                    <param name="line-order-total" value="5"/>
				</leaf>
			</subtree>

		</subtree>
		
		<subtree name="Varnish">
			<param name="sumfunc" value="ADDNAN"/>
			<param name="sumsep" value=""/>
			
			<subtree name="pmtpa">
				<param name="site" value="pmtpa"/>
				
				<subtree name="bits">
					<param name="cluster" value="bits"/>
					
					<subtree name="Totals">
						<param name="expr-Varnish" value="%expr-Varnish_bits_pmtpa%"/>
						
						<apply-template name="varnish-cluster"/>
					</subtree>
				</subtree>
			</subtree>

			<subtree name="eqiad">
				<param name="site" value="eqiad"/>
				
				<subtree name="bits">
					<param name="cluster" value="bits"/>
					
					<subtree name="Totals">
						<param name="expr-Varnish" value="%expr-Varnish_bits_eqiad%"/>
						
						<apply-template name="varnish-cluster"/>
					</subtree>
				</subtree>
			</subtree>
			
			<subtree name="esams">
				<param name="site" value="esams"/>
				
				<subtree name="bits">
					<param name="cluster" value="bits"/>
					
					<subtree name="Totals">
						<param name="expr-Varnish" value="%expr-Varnish_bits_esams%"/>
						
						<apply-template name="varnish-cluster"/>
					</subtree>
				</subtree>
			</subtree>
			
			<subtree name="Totals">
				<param name="ds-type" value="rrd-file"/>
		
				<subtree name="bits">
					<leaf name="Client_requests">
						<param name="varnishmetric" value="Clients/client_req"/>
			
						<param name="ds-type" value="rrd-multigraph"/>
						<param name="ds-names" value="pmtpa,eqiad,esams"/>
						<param name="comment" value="Total client requests"/>
						<param name="vertical-label" value="requests/s"/>
						<param name="graph-lower-limit" value="0"/>
				
						<param name="ds-expr-pmtpa" value="%expr-Varnish_bits_pmtpa%,0,1000000,LIMIT"/>
						<param name="graph-legend-pmtpa" value="pmtpa"/>
						<param name="line-style-pmtpa" value="AREA"/>
						<param name="line-stack-pmtpa" value="yes"/>
						<param name="line-color-pmtpa" value="##bits-pmtpa"/>
						<param name="line-order-pmtpa" value="1"/>

						<param name="ds-expr-eqiad" value="%expr-Varnish_bits_eqiad%,0,1000000,LIMIT"/>
						<param name="graph-legend-eqiad" value="eqiad"/>
						<param name="line-style-eqiad" value="AREA"/>
						<param name="line-stack-eqiad" value="yes"/>
						<param name="line-color-eqiad" value="##bits-eqiad"/>
						<param name="line-order-eqiad" value="2"/>

						<param name="ds-expr-esams" value="%expr-Varnish_bits_esams%,0,1000000,LIMIT"/>
						<param name="graph-legend-esams" value="esams"/>
						<param name="line-style-esams" value="STACK"/>
						<param name="line-stack-esams" value="yes"/>
						<param name="line-color-esams" value="##bits-esams"/>
						<param name="line-order-esams" value="3"/>
					</leaf>
				</subtree>
			</subtree>
		</subtree>
		
		<subtree name="Totals">
			<param name="sumfunc" value="ADDNAN"/>
			<param name="sumsep" value=""/>
			<param name="ds-type" value="rrd-file"/>
			
			<param name="precedence" value="1000"/>
			<param name="default-subtree-view" value="overview-dir-html"/>
			<param name="rrdgraph-views">
	                last24h-small,lasth24h,lastweek,lastmonth,lastyear
	        </param>
		
			<leaf name="All_client_requests">
				<param name="squidmetric" value="Usage/HTTP_requests"/>
				<param name="squidlayer" value="frontend"/>
				<param name="varnishmetric" value="Clients/client_req"/>
				
				<param name="ds-type" value="rrd-multigraph"/>
				<param name="ds-names" value="text-pmtpa,bits-pmtpa,upload-pmtpa,text-eqiad,bits-eqiad,upload-eqiad,text-esams,bits-esams,upload-esams,total"/>
				<param name="comment" value="Total of all client requests"/>
				<param name="vertical-label" value="requests/s"/>
				<param name="graph-lower-limit" value="0"/>

				<param name="ds-expr-text-pmtpa" value="%expr-Squid_text_pmtpa%"/>
				<param name="graph-legend-text-pmtpa" value="text.pmtpa"/>
				<param name="line-style-text-pmtpa" value="STACK"/>
				<param name="line-stack-text-pmtpa" value="yes"/>
				<param name="line-color-text-pmtpa" value="##text-pmtpa"/>
				<param name="line-order-text-pmtpa" value="3"/>

				<param name="ds-expr-bits-pmtpa" value="%expr-Varnish_bits_pmtpa%,0,1000000,LIMIT"/>
				<param name="graph-legend-bits-pmtpa" value="bits.pmtpa"/>
				<param name="line-style-bits-pmtpa" value="STACK"/>
				<param name="line-stack-bits-pmtpa" value="yes"/>
				<param name="line-color-bits-pmtpa" value="##bits-pmtpa"/>
				<param name="line-order-bits-pmtpa" value="2"/>

				<param name="ds-expr-upload-pmtpa" value="%expr-Squid_upload_pmtpa%"/>
				<param name="graph-legend-upload-pmtpa" value="upload.pmtpa"/>
				<param name="line-style-upload-pmtpa" value="AREA"/>
				<param name="line-stack-upload-pmtpa" value="no"/>
				<param name="line-color-upload-pmtpa" value="##upload-pmtpa"/>
				<param name="line-order-upload-pmtpa" value="1"/>

				<param name="ds-expr-text-eqiad" value="%expr-Squid_text_eqiad%"/>
				<param name="graph-legend-text-eqiad" value="text.eqiad"/>
				<param name="line-style-text-eqiad" value="STACK"/>
				<param name="line-stack-text-eqiad" value="yes"/>
				<param name="line-color-text-eqiad" value="##text-eqiad"/>
				<param name="line-order-text-eqiad" value="6"/>

				<param name="ds-expr-bits-eqiad" value="%expr-Varnish_bits_eqiad%,0,1000000,LIMIT"/>
				<param name="graph-legend-bits-eqiad" value="bits.eqiad"/>
				<param name="line-style-bits-eqiad" value="STACK"/>
				<param name="line-stack-bits-eqiad" value="yes"/>
				<param name="line-color-bits-eqiad" value="##bits-eqiad"/>
				<param name="line-order-bits-eqiad" value="5"/>

				<param name="ds-expr-upload-eqiad" value="%expr-Varnish_upload_eqiad%,0,1000000,LIMIT"/>
				<param name="graph-legend-upload-eqiad" value="upload.eqiad"/>
				<param name="line-style-upload-eqiad" value="AREA"/>
				<param name="line-stack-upload-eqiad" value="no"/>
				<param name="line-color-upload-eqiad" value="##upload-eqiad"/>
				<param name="line-order-upload-eqiad" value="4"/>

				<param name="ds-expr-text-esams" value="%expr-Squid_text_esams%"/>
				<param name="graph-legend-text-esams" value="text.esams"/>
				<param name="line-style-text-esams" value="STACK"/>
				<param name="line-stack-text-esams" value="yes"/>
				<param name="line-color-text-esams" value="##text-esams"/>
				<param name="line-order-text-esams" value="9"/>

				<param name="ds-expr-bits-esams" value="%expr-Varnish_bits_esams%,0,1000000,LIMIT"/>
				<param name="graph-legend-bits-esams" value="bits.esams"/>
				<param name="line-style-bits-esams" value="STACK"/>
				<param name="line-stack-bits-esams" value="yes"/>
				<param name="line-color-bits-esams" value="##bits-esams"/>
				<param name="line-order-bits-esams" value="8"/>

				<param name="ds-expr-upload-esams" value="%expr-Squid_upload_esams%"/>
				<param name="graph-legend-upload-esams" value="upload.esams"/>
				<param name="line-style-upload-esams" value="STACK"/>
				<param name="line-stack-upload-esams" value="yes"/>
				<param name="line-color-upload-esams" value="##upload-esams"/>
				<param name="line-order-upload-esams" value="7"/>

				<param name="ds-expr-total" value="%expr-Squid_text_pmtpa%,%expr-Varnish_bits_pmtpa%,%expr-Squid_upload_pmtpa%,%expr-Squid_text_eqiad%,%expr-Varnish_bits_eqiad%,%expr-Varnish_upload_eqiad%,%expr-Squid_text_esams%,%expr-Varnish_bits_esams%,%expr-Squid_upload_esams%,ADDNAN,ADDNAN,ADDNAN,ADDNAN,ADDNAN,ADDNAN,ADDNAN,ADDNAN,0,1000000,LIMIT"/>
				<param name="graph-legend-total" value="Total"/>
				<param name="line-style-total" value="LINE1"/>
				<param name="line-stack-total" value="no"/>
				<param name="line-color-total" value="##text-esams"/>
				<param name="line-order-total" value="7"/>
				<param name="precedence" value="1000"/>
			</leaf>

			<leaf name="All_backend_requests">
				<param name="squidmetric" value="Usage/Server_side_HTTP_requests"/>
				<param name="squidlayer" value="backend"/>
				<param name="varnishmetric" value="Backends/backend_req"/>
				
				<param name="ds-type" value="rrd-multigraph"/>
				<param name="ds-names" value="text-pmtpa,bits-pmtpa,upload-pmtpa,api-pmtpa"/>
				<param name="comment" value="All backend requests"/>
				<param name="vertical-label" value="requests/s"/>
				<param name="graph-lower-limit" value="0"/>
				
				<param name="ds-expr-text-pmtpa" value="%expr-Squid_text_pmtpa%,%expr-Squid_api_pmtpa%,-"/>
				<param name="graph-legend-text-pmtpa" value="text.pmtpa"/>
				<param name="line-style-text-pmtpa" value="LINE2"/>
				<param name="line-color-text-pmtpa" value="##text-pmtpa"/>
				<param name="line-order-text-pmtpa" value="1"/>
				
				<param name="ds-expr-bits-pmtpa" value="%expr-Varnish_bits_pmtpa%"/>
				<param name="graph-legend-bits-pmtpa" value="bits.pmtpa"/>
				<param name="line-style-bits-pmtpa" value="LINE2"/>
				<param name="line-color-bits-pmtpa" value="##bits-pmtpa"/>
				<param name="line-order-bits-pmtpa" value="2"/>
				
				<param name="ds-expr-upload-pmtpa" value="%expr-Squid_upload_pmtpa%"/>
				<param name="graph-legend-upload-pmtpa" value="upload.pmtpa"/>
				<param name="line-style-upload-pmtpa" value="LINE2"/>
				<param name="line-color-upload-pmtpa" value="##upload-pmtpa"/>
				<param name="line-order-upload-pmtpa" value="3"/>
				
				<param name="ds-expr-api-pmtpa" value="%expr-Squid_api_pmtpa%"/>
				<param name="graph-legend-api-pmtpa" value="api.pmtpa"/>
				<param name="line-style-api-pmtpa" value="LINE2"/>
				<param name="line-color-api-pmtpa" value="##red"/>
				<param name="line-order-api-pmtpa" value="4"/>

				<param name="ds-expr-bits-eqiad" value="%expr-Varnish_bits_eqiad%"/>
				<param name="graph-legend-bits-eqiad" value="bits.eqiad"/>
				<param name="line-style-bits-eqiad" value="LINE2"/>
				<param name="line-color-bits-eqiad" value="##bits-eqiad"/>
				<param name="line-order-bits-eqiad" value="5"/>
				
				<param name="precedence" value="999"/>	
			</leaf>
			
			<leaf name="Service_times">
				<!-- count values -->
				<param name="sumsep" value = "1,"/>
				<param name="sumfunc" value="1,+"/>
				
				<param name="squidmetric" value="Service_times/Miss_HTTP_requests_service_time"/>
				<param name="squidlayer" value="backend"/>
				
				<param name="ds-type" value="rrd-multigraph"/>
				<param name="ds-names" value="text-pmtpa,api-pmtpa,upload-pmtpa"/>
				<param name="comment" value="Service times"/>
				<param name="vertical-label" value="seconds"/>
				<param name="graph-lower-limit" value="0"/>
				<param name="graph-upper-limit" value="0.3"/>
				
				<param name="ds-expr-text-pmtpa" value="%expr-Squid_text_pmtpa%,AVG"/>
				<param name="graph-legend-text-pmtpa" value="text.pmtpa"/>
				<param name="line-style-text-pmtpa" value="LINE2"/>
				<param name="line-color-text-pmtpa" value="##text-pmtpa"/>
				<param name="line-order-text-pmtpa" value="1"/>
				
				<param name="ds-expr-api-pmtpa" value="%expr-Squid_api_pmtpa%,AVG"/>
				<param name="graph-legend-api-pmtpa" value="api.pmtpa"/>
				<param name="line-style-api-pmtpa" value="LINE2"/>
				<param name="line-color-api-pmtpa" value="##red"/>
				<param name="line-order-api-pmtpa" value="2"/>
				
				<param name="ds-expr-upload-pmtpa" value="%expr-Squid_upload_pmtpa%,AVG"/>
				<param name="graph-legend-upload-pmtpa" value="upload.pmtpa"/>
				<param name="line-style-upload-pmtpa" value="LINE2"/>
				<param name="line-color-upload-pmtpa" value="##upload-pmtpa"/>
				<param name="line-order-upload-pmtpa" value="3"/>
				<param name="precedence" value="998"/>			
			</leaf>
		</subtree>
	</datasources>
	
	<views>
	  	<view name="overview-dir-html">
	    	<param name="view-type"     value="html" />
	    	<param name="expires"       value="300" />
	    	<param name="html-template" value="overview-dir.html" />
			<param name="rrd-params" value="--slope-mode"/>
			<param name="width" value="600" />
			<param name="height" value="300" />
	  	</view>
		
		<view name="default-rrgraph">
			<param name="rrd-params" value="--slope-mode"/>
			
			<param name="width" value="600" />
			<param name="height" value="300" />
						
			<!-- Daily graph, inherits parameters from the above -->
			<view name="last24h">
	        	<param name="start" value="-40h" />
			</view>-->

			<!-- Weekly graph -->
			<view name="lastweek">
				<param name="start"	value="-10d" />
			</view>
		</view>
	</views>
</configuration>