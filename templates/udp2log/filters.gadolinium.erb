###
####    This file managed by puppet.
###

### udp2log packet loss monitoring
pipe 10 /usr/bin/packet-loss 10 '\t' >> <%= webrequest_log_directory %>/packet-loss.log

### 0.0001 of all udp2log messages
# This log file is also on emery for redundancy
file 1000 <%= webrequest_log_directory %>/sampled-1000.log.tsv

### All edits
pipe 1 /usr/bin/udp-filter -F '\t' -p action=submit,action=edit >> <%= webrequest_log_directory %>/edits.log.tsv

### Mobile traffic filter
# TODO: use mobile varnish frontend hostnames for
# filtering rather than 'm.wikipedia.org' domain.
pipe 100 /usr/bin/udp-filter -F '\t' -d "m.wikipedia.org" >> <%= webrequest_log_directory %>/mobile.log.tsv

### Fundraising
## Landing pages
pipe 1 /usr/bin/udp-filter -F '\t' -d wikimediafoundation.org,donate.wikimedia.org >> <%= fundraising_log_directory %>/logs/landingpages.log.tsv

## Banner Impressions
pipe 100 /usr/bin/udp-filter -F '\t' -p Special:RecordImpression\?banner=,Special:RecordImpression\?result= >> <%= fundraising_log_directory %>/logs/bannerImpressions-sampled100.log.tsv





#### These are still on locke:

### Vrije Universiteit
# Contact: <%= scope.lookupvar('contacts::udp2log::vrije_universiteit_contact') %>
# pipe 10 awk -f <%= webrequest_log_directory %>/bin/vu.awk | log2udp -h 130.37.198.252 -p 9999

### University of Minnesota
# Contact: <%= scope.lookupvar('contacts::udp2log::university_minnesota_contact') %>
# Former Contact: <%= scope.lookupvar('contacts::udp2log::university_minnesota_contact_former') %>
# Former contact: <%= scope.lookupvar('contacts::udp2log::university_minnesota_contact_former2') %>
# pipe 10 awk -f <%= webrequest_log_directory %>/bin/minnesota.awk | log2udp -h bento.cs.umn.edu -p 9999


### domas' stuff.
# (This looks like a bunch of C to filter for mobile pages
# and output things by language.)
# pipe 1 /a/webstats/bin/filter | log2udp -h 127.0.0.1 -p 3815

### All 5xx error responses -- domas
# TODO: /usr/bin/udp-filter -F '\t' -r -s '^5' | awk -W interactive '$9 !~ "upload.wikimedia.org|query.php"' >> <%= webrequest_log_directory %>/5xx.log.tsv
# pipe 1 <%= webrequest_log_directory %>/5xx-filter | awk -W interactive '$9 !~ "upload.wikimedia.org|query.php"' >> <%= webrequest_log_directory %>/5xx.log.tsv

