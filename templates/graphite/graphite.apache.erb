# Apache configuration for graphite.wikimedia.org
# This file is managed by Puppet.
<VirtualHost *:80>
    ServerName <%= @hostname %>

    <Location />
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
        <IfVersion < 2.4>
            Order allow,deny
            Allow from all
        </IfVersion>

<%= @apache_auth -%>

        # uWSGI reverse-proxy
        uWSGIsocket /run/uwsgi/graphite-web.sock
        uWSGIForceWSGIScheme https
        SetHandler uwsgi-handler
    </Location>

    <Location ~ "/(render|metrics)">
        <IfVersion >= 2.4>
            Require all granted
        </IfVersion>
        <IfVersion < 2.4>
            Satisfy Any
            Allow from all
        </IfVersion>
    </Location>

</VirtualHost>
