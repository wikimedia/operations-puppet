[gerrit]
	basePath = git
	canonicalWebUrl = <%= scope.lookupvar('gerrit::gerrit_config::gerrit_url') %>
[core]
	packedGitOpenFiles = 4096
	packedGitLimit = 500m
	packedGitWindowSize = 16k
	streamFileThreshold = 100m
[database]
	type = MYSQL
	hostname = <%= scope.lookupvar('gerrit::gerrit_config::gerrit_db_host') %>
	database = <%= scope.lookupvar('gerrit::gerrit_config::gerrit_db_name') %>
	url = jdbc:mysql://<%= scope.lookupvar('gerrit::gerrit_config::gerrit_db_host') %>/<%= scope.lookupvar('gerrit::gerrit_config::gerrit_db_name') %>?characterSetResults=utf8&characterEncoding=utf8&connectionCollation=utf8_unicode_ci
[auth]
	type = LDAP
	cookieSecure = true
	registerUrl = http://www.mediawiki.org/wiki/Commit_access
[ldap]
	server = ldaps://<%= scope.lookupvar('gerrit::gerrit_config::gerrit_ldap_host') %>

	accountBase = ou=people,<%= scope.lookupvar('gerrit::gerrit_config::gerrit_ldap_base_dn') %>
	accountPattern = (&(objectClass=person)(cn=${username}))
	accountFullName = cn

	groupBase = ou=groups,<%= scope.lookupvar('gerrit::gerrit_config::gerrit_ldap_base_dn') %>
	groupMemberPattern = (&(objectClass=groupOfNames)(member=${dn}))
	groupScope = one
[sendemail]
	smtpServer = smtp.pmtpa.wmnet
	smtpServerPort = 25
[container]
	user = gerrit2
	javaHome = /usr/lib/jvm/java-6-openjdk/jre
	heapLimit = 2g
	<% if has_variable?("gerrit_slave") then %>slave = true<% end %>
[sshd]
	listenAddress = *:29418
	threads = 8
	batchThreads = 2
[httpd]
	listenUrl = <%= scope.lookupvar('gerrit::gerrit_config::gerrit_listen_url') %>
[cache]
	directory = cache
[cache "web_sessions"]
	maxAge = <%= scope.lookupvar('gerrit::gerrit_config::gerrit_session_timeout') %>
[gitweb]
	cgi = /usr/lib/cgi-bin/gitweb.cgi
	url = /r/gitweb
[user]
	email = "gerrit@wikimedia.org"
[commentlink "changeid"]
	match = "(?:^|[^-?=;0-9A-Za-z])(I[0-9a-f]{8,40})(?:[^-?=;0-9A-Za-z]|$)"
	link = "#q,$1,n,z"
[commentlink "commit"]
	match = "(?:^|[^-?=;0-9A-Za-z])([0-9a-f]{40})(?:[^-?=;0-9A-Za-z]|$)"
	link = "#q,$1,n,z"
[commentlink "bugzilla"]
	match = "\\b([Bb][Uu][Gg]\\s*\\#?\\s*(\\d+))([\\s,]*[^Cc]|$)"
	html = <a href="https://bugzilla.wikimedia.org/$2">$1</a>$3
[commentlink "bugzillacomment"]
	match = "\\b(?:[Bb][Uu][Gg]\\s*\\#?\\s*(\\d+)\\s*,?\\s*[Cc][Oo][Mm][Mm][Ee][Nn][Tt]\\s*\\#?\\s*(\\d+))\\b"
	link = https://bugzilla.wikimedia.org/$1#c$2
[commentlink "codereview"]
	match = "\\br(\\d+)\\b"
	link = https://www.mediawiki.org/wiki/Special:CodeReview/MediaWiki/$1
[commentlink "rt"]
	match = "\\b[rR][tT]\\s*[-#]?\\s*(\\d+)"
	link = https://rt.wikimedia.org/Ticket/Display.html?id=$1
[mimetype "image/*"]
	safe = true
[repository "*"]
	ownerGroup = Project Creators
[pack]
	deltacompression = true
