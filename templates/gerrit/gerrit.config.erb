[gerrit]
	basePath = git
	canonicalWebUrl = <%= scope.lookupvar('gerrit::instance::url') %>
[core]
	packedGitOpenFiles = 4096
	packedGitLimit = 500m
	packedGitWindowSize = 16k
	streamFileThreshold = 100m
[database]
	type = MYSQL
	hostname = <%= scope.lookupvar('gerrit::instance::dbhost') %>
	database = <%= scope.lookupvar('gerrit::instance::dbname') %>
	url = jdbc:mysql://<%= scope.lookupvar('gerrit::instance::dbhost') %>/<%= scope.lookupvar('gerrit::instance::dbname') %>?characterSetResults=utf8&characterEncoding=utf8&connectionCollation=utf8_unicode_ci
[auth]
	type = LDAP
	cookieSecure = true
	registerUrl = http://www.mediawiki.org/wiki/Commit_access
[ldap]
	server = <% scope.lookupvar('gerrit::gerrit_config::gerrit_ldap_host').each do |ldap_host| %>ldaps://<%= ldap_host %> <% end %>

	accountBase = ou=people,<%= scope.lookupvar('gerrit::gerrit_config::gerrit_ldap_base_dn') %>
	accountPattern = (&(objectClass=person)(cn=${username}))
	accountFullName = cn

	groupBase = ou=groups,<%= scope.lookupvar('gerrit::gerrit_config::gerrit_ldap_base_dn') %>
	groupMemberPattern = (&(objectClass=groupOfNames)(member=${dn}))
	groupScope = one
[sendemail]
	smtpServer = smtp.pmtpa.wmnet
	smtpServerPort = 25
[container]
	user = gerrit2
	javaHome = /usr/lib/jvm/java-6-openjdk/jre
	heapLimit = 2g
	<% if has_variable?("gerrit_slave") then %>slave = true<% end %>
[sshd]
	listenAddress = *:<%= scope.lookupvar('gerrit::instance::sshport')
	threads = 8
	batchThreads = 2
[httpd]
	listenUrl = proxy-https://127.0.0.1:8080/r/
[cache]
	directory = cache
[cache "web_sessions"]
	maxAge = 90 days
[gitweb]
	cgi = /usr/lib/cgi-bin/gitweb.cgi
	url = /r/gitweb
[user]
	email = "gerrit@wikimedia.org"
[commentlink "changeid"]
	match = (I[0-9a-f]{8,40})
	link = "#q,$1,n,z"
[commentlink "commit"]
	match = "\\b([0-9a-f]{40})\\b"
	link = "#q,$1,n,z"
[commentlink "bugzilla"]
	match = "\\b([bB][uU][gG]\\s+#?)(\\d+)\\b"
	link = https://bugzilla.wikimedia.org/$2
[commentlink "codereview"]
	match = "r(\\d+)"
	link = https://www.mediawiki.org/wiki/Special:CodeReview/MediaWiki/$1
[commentlink "rt"]
	match = "\\b[rR][tT]\\s+#?(\\d+)"
	link = https://rt.wikimedia.org/Ticket/Display.html?id=$1
[mimetype "image/*"]
	safe = true
[repository "*"]
	ownerGroup = Project and Group Creators
[pack]
	deltacompression = true
