# Varnish VCL include file for Parsoid frontends

# Include common Parsoid config shared between front- and backend
include "parsoid-common.inc.vcl";

sub vcl_miss {
	// forward the Cache-Control header to the backend
	if ( req.http.Cache-Control )
	{
		set bereq.http.Cache-Control = req.http.Cache-Control;
	}
}

sub vcl_fetch {
	set beresp.ttl = 0s;
}

sub vcl_deliver {
    // Don't report stale performance data if request was a cache hit.
    if (obj.hits > 0) {
        unset resp.http.X-Parsoid-Performance;
    }
}
