include "errorpage.inc.vcl";

sub vcl_recv {
	if (req.http.Host == "git.wikimedia.org") {
		set req.backend = antimony;
		/* gitblit requires the following request headers: */
		set req.http.X-Forwarded-Proto = "https";
		set req.http.X-Forwarded-Port = "443";
		return (lookup);
	} elsif (req.http.Host == "gerrit.wikimedia.org") {
		set req.backend = ytterbium;
		return (lookup);
	} elsif (req.http.Host == "gdash.wikimedia.org" || req.http.Host == "graphite.wikimedia.org") {
		set req.backend = tungsten;
		return (lookup);
	}
}

sub vcl_error {
	call errorpage;
	return(deliver);
}
