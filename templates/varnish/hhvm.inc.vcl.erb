# Common functions for HHVM handling

sub hhvm_add_vary {
	/* Set Vary to depend on X-Use-HHVM */
	if (beresp.http.Vary !~ "X-Use-HHVM") {
		if (beresp.http.Vary) {
			set beresp.http.Vary = beresp.http.Vary + ",X-Use-HHVM";
		} else {
			set beresp.http.Vary = "X-Use-HHVM";
		}
	}
}


/* Manage X-Analytics token for HHVM/Zend tracking */
sub php_mark_engine {	
	if (resp.http.X-Analytics) {
		if (resp.http.X-Powered-By ~ "^HHVM") {
			set resp.http.X-Analytics = resp.http.X-Analytics + ";php=hhvm";
		} else {
			set resp.http.X-Analytics = resp.http.X-Analytics + ";php=zend";
		}
	} else {
		if (resp.http.X-Powered-By ~ "^HHVM") {
			set resp.http.X-Analytics = "php=hhvm";
		} else {
			set resp.http.X-Analytics = "php=zend";
		}
	}
}
