sub errorpage {
	if (obj.status >= 400) {
		call synth_errorpage;
		return (deliver);
	}
}

sub synth_errorpage {
	set obj.http.Content-Type = "text/html; charset=utf-8";
	synthetic {"
<!DOCTYPE html>
<html lang=en>
<title>Wikimedia Error</title>
<style>
* { margin: 0; padding: 0; }
body { background: #fff; font: 14px/1.6 sans-serif; color: #333; }
.content { margin: 7% auto 0; padding: 2em 1em 1em; max-width: 560px; }
.footer { clear: both; margin-top: 14%; border-top: 1px solid #e5e5e5; padding: 2em 0; background: #f9f9f9; font-size: 0.8em; text-align: center; }
img { float: left; margin: 0 2em 2em 0; }
a img { border: 0; }
h1 { margin-top: 1em; font-size: 1.2em; }
p { margin: 0.7em 0 1em 0; }
a { color: #0645AD; text-decoration: none; }
a:hover { text-decoration: underline; }
em { font-style: normal; color: #777; }
</style>
<div class="content" role="main">
<a href="//www.wikimedia.org"><img src="//www.wikimedia.org/static/images/wmf.png" srcset="//www.wikimedia.org/static/images/wmf-2x.png 2x" alt=Wikimedia width=135 height=135></a>
<h1>Error</h1>
<p>Our servers are currently experiencing a technical problem. This is probably temporary and should be fixed soon.<br>Please <a href="" onclick="window.location.reload(false); return false">try again</a> in a few minutes.</p>
</div>
<div class="footer">
<p>If you report this error to the Wikimedia System Administrators, please include the details below.</p>
<em>
Request: "} + req.request + " http://" + req.http.host + regsuball(req.url, "<", "%3C") + ", from " + client.ip + " via " + server.hostname + " " + server.identity + " ([" + server.ip + "]:" + server.port + "), Varnish XID " + req.xid + "<br/>" +
regsub(req.http.X-Forwarded-For, ".+", "Forwarded for: \0<br/>") + regsub(obj.http.X-Cache, ".+", "Upstream caches: \0<br/>") +
"Error: " + obj.status + ", " + obj.response + " at " + now +
{"
</em></div></html>
"};
}
