# Varnish VCL include file for upload frontends

sub vcl_recv {
	call vcl_recv_purge;

	if (req.request != "GET" && req.request != "HEAD") {
		/* We only deal with GET, HEAD at this point */
		error 403 "HTTP method not allowed.";
	}

	if ( req.http.host == "upload.wikimedia.org") {
		return (lookup);
	} else {
		error 403 "Requested target domain not allowed.";
	}
}

sub vcl_fetch {
	# Cache media objects for 1 hour by default
	set beresp.ttl = 1h;
}