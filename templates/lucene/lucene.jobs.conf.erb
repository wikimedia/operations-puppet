#######################################################################
# WARNING: this file is managed by Puppet
# puppet:///templates/search/lucene.jobs.conf.erb
#
# Configuration variables comes from role::lucene::configuration
#######################################################################

# Configuration script for lucene.jobs.sh runner.  It is sourced inside
# the shell script and let you override the inner settings.
<%

# Fetch configuration hash from puppet scope
full_conf = scope.lookupvar('role::lucene::configuration::lucene_jobs')
realm  = scope.lookupvar('::realm')
jobs_config = full_conf[realm]

# Helper to convert the puppet hash to bash variables having
# the -Xms and -Xmx settings.
def java_opts(name, conf_hash)
	opts = []

	heap_init = conf_hash.fetch( 'java_heap_size_initial' )
	if heap_init
		opts << '-Xms' + heap_init
	end

	heap_max = conf_hash.fetch( 'java_heap_size_maximum' )
	if heap_max
		opts << '-Xmx' + heap_max
	end

	if opts.empty?
		# Commented out setting
		return "#%s=''" % [ name ]
	else
		# Or actually expand the options
		return "%s='%s'" % [ name, opts.join(' ') ]
	end
end
-%>
<%= java_opts( 'JAVA_OPTS_IMPORTER', jobs_config['importer']) %>
<%= java_opts( 'JAVA_OPTS_PREFIXINDEXBUILDER', jobs_config['prefixindexbuilder']) %>
<%= java_opts( 'JAVA_OPTS_RELATEDBUILDER', jobs_config['relatedbuilder']) %>
<%= java_opts( 'JAVA_OPTS_SUGGESTBUILDER', jobs_config['suggestbuilder']) %>
