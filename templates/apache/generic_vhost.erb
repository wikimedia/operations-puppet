# This file is managed by Puppet!

<% if ["true", "false"].include?(ssl) -%>
<VirtualHost *:80>
	ServerName <%= title %>
<% if aliases.length > 0 -%>
	ServerAlias <%= aliases.join(" ") %>
<% end -%>
	ServerAdmin <%= server_admin %>

	DocumentRoot <%= docroot %>
	<Directory <%= docroot %>>
		Options Indexes FollowSymLinks MultiViews
		AllowOverride None
		Order allow,deny
		allow from all
	</Directory>

	ErrorLog <%= error_log %>
	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog <%= access_log %> combined
	ServerSignature On

<% custom.each do |customconfig| -%>
	<%= customconfig %>
<% end -%>
	
<% includes.each do |include| -%>
	Include <%= include %>
<% end -%>
</VirtualHost>
<% end -%>

<% if ssl == "redirected" -%>
<VirtualHost *:80>
	ServerName <%= title %>
<% if aliases.length > 0 -%>
	ServerAlias <%= aliases.join(" ") %>
<% end -%>
	ServerAdmin <%= server_admin %>

	Redirect permanent / https://<%= title %>/
</VirtualHost>
<% else %>

<% if ["true", "only", "redirected"].include?(ssl) -%>
<VirtualHost *:443>
	ServerName <%= title %>
<% if aliases.length > 0 -%>
	ServerAlias <%= aliases.join(" ") %>
<% end -%>
	ServerAdmin <%= server_admin %>

	SSLEngine on
	SSLProtocol -ALL +SSLv3 +TLSv1
	SSLCipherSuite AES128-GCM-SHA256:RC4-SHA:RC4-MD5:DES-CBC3-SHA:AES128-SHA:AES256-SHA
	SSLHonorCipherOrder on
	SSLCertificateFile <%= certfile %>
	SSLCertificateKeyFile <%= certkey %>
	SSLCACertificatePath /etc/ssl/certs

	DocumentRoot <%= docroot %>
	<Directory <%= docroot %>>
		Options Indexes FollowSymLinks MultiViews
		AllowOverride None
		Order allow,deny
		allow from all
	</Directory>

	ErrorLog <%= error_log %>
	# Possible values include: debug, info, notice, warn, error, crit,
	# alert, emerg.
	LogLevel warn

	CustomLog <%= access_log %> combined
	ServerSignature On

<% custom.each do |customconfig| -%>
	<%= customconfig %>
<% end -%>

<% includes.each do |include| -%>
	Include <%= include %>
<% end -%>
</VirtualHost>
<% end -%>


# vim: filetype=apache
