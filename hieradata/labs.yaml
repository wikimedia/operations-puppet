# General variables that once would have been in realm.pp
realm: labs
datacenters: [eqiad]
standard::has_ganglia: false
has_nrpe: false
discovery::app_routes:
  mediawiki: "%{::site}"
  parsoid: "%{::site}"
  restbase: "%{::site}"
  mobileapps: "%{::site}"
  graphoid: "%{::site}"
  mathoid: "%{::site}"
  aqs: 'eqiad'

# dns
labsdnsconfig:
  recursor: 'labs-recursor0.wikimedia.org'
  recursor_secondary: 'labs-recursor1.wikimedia.org'

# Additional base overrides
standard::has_admin: false
base::remote_syslog::enable: false

# Labs statsd instance
statsd: labmon1001.eqiad.wmnet:8125

# Other overrides
elasticsearch::minimum_master_nodes: 1
elasticsearch::recover_after_time: "1m"
elasticsearch::heap_memory: '2G'
elasticsearch::expected_nodes: 1
elasticsearch::recover_after_nodes: 1
archiva::proxy::ssl_enabled: false
archiva::proxy::certificate_name: ssl-cert-snakeoil
statsite::instance::graphite_host: 'labmon1001.eqiad.wmnet'

# Cache-layer stuff
cache::route_table:
    eqiad: 'direct'
cache::text::nodes:
    eqiad:
      - '127.0.0.1'
cache::upload::nodes:
    eqiad:
      - '127.0.0.1'
cache::maps::nodes:
    eqiad:
      - '127.0.0.1'
cache::text::apps:
  appservers:
    route: eqiad
    backends:
      eqiad:
        - '10.68.19.128' # deployment-mediawiki04
        - '10.68.22.21'  # deployment-mediawiki05
  api:
    route: eqiad
    backends:
      eqiad:
        - '10.68.19.128' # deployment-mediawiki04
        - '10.68.22.21'  # deployment-mediawiki05
  rendering:
    route: eqiad
    backends:
      eqiad:
        - '10.68.19.128' # deployment-mediawiki04
        - '10.68.22.21'  # deployment-mediawiki05
  security_audit:
    route: eqiad
    backends:
      eqiad: '10.68.19.241' # deployment-mediawiki06
  appservers_debug:
    route: eqiad
    backends:
      eqiad: '10.68.19.128' # deployment-mediawiki04
  cxserver:
    route: eqiad
    backends:
      eqiad: 'cxserver-beta.wmflabs.org'
  citoid:
    route: eqiad
    backends:
      eqiad: 'citoid.wmflabs.org'
  restbase:
    route: eqiad
    backends:
      eqiad: 'deployment-restbase01.eqiad.wmflabs'
cache::upload::apps:
  swift:
    route: eqiad
    backends:
      eqiad: '10.68.16.96' # deployment-ms-fe01.deployment-prep.eqiad.wmflabs
  swift_thumbs:
    route: eqiad
    backends:
      eqiad: '10.68.16.96' # deployment-ms-fe01.deployment-prep.eqiad.wmflabs
role::cache::base::zero_site: 'https://zero.wikimedia.beta.wmflabs.org'
role::cache::base::purge_host_only_upload_re: '^upload\.beta\.wmflabs\.org$'
role::cache::base::purge_host_not_upload_re: '^(?!upload\.beta\.wmflabs\.org)'
role::cache::upload::upload_domain: 'upload.beta.wmflabs.org'
role::cache::text::static_host: 'deployment.wikimedia.beta.wmflabs.org'
role::cache::text::shortener_domain: 'w-beta.wmflabs.org'
role::cache::text::top_domain: 'beta.wmflabs.org'
role::cache::2layer::storage_parts:
  - vdb
  - vdb
varnish::dynamic_directors: false

swift::proxy::tld: 'beta.wmflabs.org'


zookeeper_cluster_name: "%{::labsproject}"
zookeeper_clusters:
  "%{::labsproject}":
    hosts:
      "%{::fqdn}": 1

nrpe::allowed_hosts: '10.68.16.195' # icinga

ssh::server::disable_agent_forwarding: false
labs_puppet_master: "labs-puppetmaster-eqiad.wikimedia.org"
puppetmaster: "labs-puppetmaster-eqiad.wikimedia.org"
saltmaster: "labs-puppetmaster-eqiad.wikimedia.org"
mysql::server::use_apparmor: false  # The images we have for debian don't support it

# All labs instances have internet connectivity, so do not bother with proxies
apt::use_proxy: false

# By default, nag project admins about puppet breakage
send_puppet_failure_emails: true


# For any Analytics Cluster in labs:
cdh::hadoop::datanode_mounts:
    - /var/lib/hadoop/data/a
    - /var/lib/hadoop/data/b

# Default to creating home directories for all
# users in the current Labs Project.
cdh::hadoop::users::groups: project-%{::labsproject}

labsldapconfig:
  hostname: ldap-labs.eqiad.wikimedia.org
  secondary_hostname: ldap-labs.codfw.wikimedia.org
