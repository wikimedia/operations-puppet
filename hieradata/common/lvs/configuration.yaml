lvs::configuration::lvs_service_ips:
  apaches: &id001 {codfw: 10.2.1.1, eqiad: 10.2.2.1}
  apertium: &id002 {codfw: 10.2.1.11, eqiad: 10.2.2.11}
  api: &id003 {codfw: 10.2.1.22, eqiad: 10.2.2.22}
  aqs: &id004 {eqiad: 10.2.2.12}
  citoid: &id005 {codfw: 10.2.1.19, eqiad: 10.2.2.19}
  cxserver: &id006 {codfw: 10.2.1.18, eqiad: 10.2.2.18}
  dns_rec: &id007
    codfw: {dns_rec: 208.80.153.254, dns_rec6: '2620:0:860:ed1a::3:fe'}
    eqiad: {dns_rec: 208.80.154.239, dns_rec6: '2620:0:861:ed1a::3:fe'}
    esams: {dns_rec: 91.198.174.216, dns_rec6: '2620:0:862:ed1a::3:fe'}
  eventbus: &id008 {codfw: 10.2.1.23, eqiad: 10.2.2.23}
  git-ssh: &id009
    eqiad: {git-ssh4: 208.80.154.250, git-ssh6: '2620:0:861:ed1a::3:16'}
  graphoid: &id010 {codfw: 10.2.1.15, eqiad: 10.2.2.15}
  kartotherian: &id011 {codfw: 10.2.1.13, eqiad: 10.2.2.13}
  maps: &id012
    codfw: {mapslb: 208.80.153.244, mapslb6: '2620:0:860:ed1a::2:d'}
    eqiad: {mapslb: 208.80.154.244, mapslb6: '2620:0:861:ed1a::2:d'}
    esams: {mapslb: 91.198.174.209, mapslb6: '2620:0:862:ed1a::2:d'}
    ulsfo: {mapslb: 198.35.26.113, mapslb6: '2620:0:863:ed1a::2:d'}
  mathoid: &id013 {codfw: 10.2.1.20, eqiad: 10.2.2.20}
  misc_web: &id014
    codfw: {misc_weblb: 208.80.153.248, misc_weblb6: '2620:0:860:ed1a::3:d'}
    eqiad: {misc_weblb: 208.80.154.251, misc_weblb6: '2620:0:861:ed1a::3:d'}
    esams: {misc_weblb: 91.198.174.217, misc_weblb6: '2620:0:862:ed1a::3:d'}
    ulsfo: {misc_weblb: 198.35.26.120, misc_weblb6: '2620:0:863:ed1a::3:d'}
  mobileapps: &id015 {codfw: 10.2.1.14, eqiad: 10.2.2.14}
  ocg: &id016 {eqiad: 10.2.2.31}
  ores: &id017 {codfw: 10.2.1.10, eqiad: 10.2.2.10}
  parsoid: &id018 {codfw: 10.2.1.28, eqiad: 10.2.2.28}
  prometheus: &id019 {codfw: 10.2.1.25, eqiad: 10.2.2.25}
  rendering: &id020 {codfw: 10.2.1.21, eqiad: 10.2.2.21}
  restbase: &id021 {codfw: 10.2.1.17, eqiad: 10.2.2.17}
  search: &id022 {codfw: 10.2.1.30, eqiad: 10.2.2.30}
  swift: &id023 {codfw: 10.2.1.27, eqiad: 10.2.2.27}
  text: &id024
    codfw: {textlb: 208.80.153.224, textlb6: '2620:0:860:ed1a::1'}
    eqiad: {textlb: 208.80.154.224, textlb6: '2620:0:861:ed1a::1'}
    esams: {textlb: 91.198.174.192, textlb6: '2620:0:862:ed1a::1'}
    ulsfo: {textlb: 198.35.26.96, textlb6: '2620:0:863:ed1a::1'}
  thumbor: &id025 {codfw: 10.2.1.24, eqiad: 10.2.2.24}
  upload: &id026
    codfw: {uploadlb: 208.80.153.240, uploadlb6: '2620:0:860:ed1a::2:b'}
    eqiad: {uploadlb: 208.80.154.240, uploadlb6: '2620:0:861:ed1a::2:b'}
    esams: {uploadlb: 91.198.174.208, uploadlb6: '2620:0:862:ed1a::2:b'}
    ulsfo: {uploadlb: 198.35.26.112, uploadlb6: '2620:0:863:ed1a::2:b'}
  zotero: &id027 {codfw: 10.2.1.16, eqiad: 10.2.2.16}
lvs::configuration::lvs_services:
  apaches:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: appserver, service: apache2}
    depool-threshold: '.9'
    description: Main MediaWiki application server cluster, appservers.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs!en.wikipedia.org!/wiki/Special:BlankPage
      sites:
        eqiad: {hostname: appservers.svc.eqiad.wmnet}
    ip: *id001
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://en.wikipedia.org/wiki/Special:BlankPage']
      RunCommand: {arguments: '[ ''/etc/pybal/runcommand/check-apache'', server.host
          ]', command: /bin/sh, interval: 60, timeout: 10}
    sites: [eqiad, codfw]
  apertium:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: sca, service: apertium}
    depool-threshold: '.5'
    description: Machine Translation service. apertium.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!apertium.svc.%{::site}.wmnet!2737!/listPairs
      sites:
        codfw: {hostname: apertium.svc.codfw.wmnet}
        eqiad: {hostname: apertium.svc.eqiad.wmnet}
    ip: *id002
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/listPairs']
    port: 2737
    sites: [codfw, eqiad]
  api:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: api_appserver, service: apache2}
    depool-threshold: '.6'
    description: MediaWiki API cluster, api.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs!en.wikipedia.org!/w/api.php?action=query&meta=siteinfo
      sites:
        eqiad: {hostname: api.svc.eqiad.wmnet}
    ip: *id003
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://en.wikipedia.org/w/api.php']
      RunCommand: {arguments: '[ ''/etc/pybal/runcommand/check-apache'', server.host
          ]', command: /bin/sh, interval: 60, timeout: 10}
    sites: [eqiad, codfw]
  aqs:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: aqs, service: aqs}
    depool-threshold: '.5'
    description: Analytics Query Service, aqs.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!aqs.svc.%{::site}.wmnet!7232!/
      sites:
        eqiad: {hostname: aqs.svc.eqiad.wmnet}
    ip: *id004
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/']
    port: 7232
    sites: [eqiad]
  citoid:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: scb, service: citoid}
    depool-threshold: '.5'
    description: Citation lookup service, citoid.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!citoid.svc.%{::site}.wmnet!1970!/_info
      contact_group: admins,parsoid
      sites:
        codfw: {hostname: citoid.svc.codfw.wmnet}
        eqiad: {hostname: citoid.svc.eqiad.wmnet}
    ip: *id005
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/_info']
    port: 1970
    sites: [eqiad, codfw]
  cxserver:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: scb, service: cxserver}
    depool-threshold: '.5'
    description: Content Translation service, cxserver.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!cxserver.svc.%{::site}.wmnet!8080!/_info
      sites:
        codfw: {hostname: cxserver.svc.codfw.wmnet}
        eqiad: {hostname: cxserver.svc.eqiad.wmnet}
    ip: *id006
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/_info']
    port: 8080
    sites: [eqiad, codfw]
  dns_rec:
    bgp: 'no'
    class: high-traffic2
    conftool: {cluster: dns, service: pdns_recursor}
    depool-threshold: '.5'
    description: Recursive DNS - TCP
    ip: *id007
    monitors:
      DNSQuery:
        fail-on-nxdomain: 'no'
        hostnames: [en.wikipedia.org, www.google.com]
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    port: 53
    protocol: tcp
    sites: [eqiad, codfw, esams]
  dns_rec_udp:
    bgp: 'yes'
    class: high-traffic2
    conftool: {cluster: dns, service: pdns_recursor}
    depool-threshold: '.5'
    description: Recursive DNS - UDP
    ip: *id007
    monitors:
      DNSQuery:
        fail-on-nxdomain: 'no'
        hostnames: [en.wikipedia.org, www.google.com]
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    port: 53
    protocol: udp
    sites: [eqiad, codfw, esams]
  eventbus:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: eventbus, service: eventbus}
    depool-threshold: '.5'
    description: HTTP Event Producer Service
    icinga:
      check_command: check_http_lvs_on_port!eventbus.svc.%{::site}.wmnet!8085!/v1/topics
      sites:
        codfw: {hostname: eventbus.svc.codfw.wmnet}
        eqiad: {hostname: eventbus.svc.eqiad.wmnet}
    ip: *id008
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/v1/topics']
    port: 8085
    sites: [eqiad, codfw]
  git-ssh:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: phabricator, service: git-ssh}
    depool-threshold: '.6'
    description: Git - to Phabricator hosting, git-ssh.wikimedia.org
    ip: *id009
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    port: 22
    sites: [eqiad]
  graphoid:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: scb, service: graphoid}
    depool-threshold: '.5'
    description: Graph-rendering service, graphoid.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!graphoid.svc.%{::site}.wmnet!19000!/_info
      contact_group: admins,parsoid
      sites:
        codfw: {hostname: graphoid.svc.codfw.wmnet}
        eqiad: {hostname: graphoid.svc.eqiad.wmnet}
    ip: *id010
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/_info']
    port: 19000
    sites: [eqiad, codfw]
  kartotherian:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: maps, service: kartotherian}
    depool-threshold: '.5'
    description: Kartotherian, kartotherian.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!kartotherian.svc.%{::site}.wmnet!6533!/osm-intl/6/23/24.png
      sites:
        codfw: {hostname: kartotherian.svc.codfw.wmnet}
        eqiad: {hostname: kartotherian.svc.eqiad.wmnet}
    ip: *id011
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    port: 6533
    sites: [codfw, eqiad]
  maps:
    bgp: 'yes'
    class: high-traffic2
    conftool: {cluster: cache_maps, service: varnish-fe}
    depool-threshold: '.5'
    description: Maps service maps-lb.%{::site}.wikimedia.org
    icinga:
      sites:
        codfw: {hostname: maps-lb.codfw.wikimedia.org}
        eqiad: {hostname: maps-lb.eqiad.wikimedia.org}
        esams: {hostname: maps-lb.esams.wikimedia.org}
        ulsfo: {hostname: maps-lb.ulsfo.wikimedia.org}
      uri: maps.wikimedia.org!/osm-intl/6/23/24.png
    ip: *id012
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  maps-https:
    bgp: 'no'
    class: high-traffic2
    conftool: {cluster: cache_maps, service: nginx}
    depool-threshold: '.5'
    description: Maps service maps-lb.%{::site}.wikimedia.org
    ip: *id012
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['https://varnishcheck.wikimedia.org/from/pybal']
    port: 443
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  mathoid:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: scb, service: mathoid}
    depool-threshold: '.5'
    description: Mathematical rendering service, mathoid.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!mathoid.svc.%{::site}.wmnet!10042!/_info
      sites:
        codfw: {hostname: mathoid.svc.codfw.wmnet}
        eqiad: {hostname: mathoid.svc.eqiad.wmnet}
    ip: *id013
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/_info']
    port: 10042
    sites: [eqiad, codfw]
  misc_web:
    bgp: 'yes'
    class: high-traffic2
    conftool: {cluster: cache_misc, service: varnish-fe}
    depool-threshold: '.5'
    description: Miscellaneous web sites Varnish cluster
    icinga:
      sites:
        codfw: {hostname: misc-web-lb.codfw.wikimedia.org}
        eqiad: {hostname: misc-web-lb.eqiad.wikimedia.org}
        esams: {hostname: misc-web-lb.esams.wikimedia.org}
        ulsfo: {hostname: misc-web-lb.ulsfo.wikimedia.org}
      uri: varnishcheck!/
    ip: *id014
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  misc_web-https:
    bgp: 'no'
    class: high-traffic2
    conftool: {cluster: cache_misc, service: nginx}
    depool-threshold: '.5'
    description: Miscellaneous web sites Varnish cluster (HTTPS)
    ip: *id014
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['https://varnishcheck.wikimedia.org/from/pybal']
    port: 443
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  mobileapps:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: scb, service: mobileapps}
    depool-threshold: '.5'
    description: A service for use by mobile apps. Provides DOM manipulation, aggregation,
      JSON flattening. mobileapps.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!mobileapps.svc.%{::site}.wmnet!8888!/_info
      sites:
        codfw: {hostname: mobileapps.svc.codfw.wmnet}
        eqiad: {hostname: mobileapps.svc.eqiad.wmnet}
    ip: *id015
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    port: 8888
    sites: [eqiad, codfw]
  ocg:
    bgp: 'yes'
    class: high-traffic2
    conftool: {cluster: pdf, service: ocg}
    depool-threshold: '.5'
    description: Offline Content Generator (e.g. PDF), ocg.svc.eqiad.wmnet
    icinga:
      check_command: check_http_lvs_on_port!ocg.svc.eqiad.wmnet!8000!/?command=health
      sites:
        eqiad: {hostname: ocg.svc.eqiad.wmnet}
    ip: *id016
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/?command=health']
    port: 8000
    sites: [eqiad]
  ores:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: scb, service: ores}
    depool-threshold: '.5'
    description: Objective Revision Evaluation Service. ores.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!ores.svc.%{::site}.wmnet!8081!/v2/scores/
      sites:
        eqiad: {hostname: ores.svc.eqiad.wmnet}
    ip: *id017
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/v2/scores/']
    port: 8081
    sites: [eqiad, codfw]
  parsoid:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: parsoid, service: parsoid}
    depool-threshold: '.5'
    description: Parsoid wikitext parser for VisualEditor (%{::site})
    icinga:
      check_command: check_http_on_port!8000
      contact_group: admins,parsoid
      sites:
        codfw: {hostname: parsoid.svc.codfw.wmnet}
        eqiad: {hostname: parsoid.svc.eqiad.wmnet}
    ip: *id018
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/']
    port: 8000
    sites: [eqiad, codfw]
  prometheus:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: prometheus, service: prometheus}
    depool-threshold: '.5'
    description: Prometheus monitoring
    icinga:
      check_command: check_http_lvs_on_port!prometheus.svc.%{::site}.wmnet!80!/
      sites:
        codfw: {hostname: prometheus.svc.codfw.wmnet}
        eqiad: {hostname: prometheus.svc.eqiad.wmnet}
    ip: *id019
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/']
    port: 80
    sites: [eqiad, codfw]
  rendering:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: imagescaler, service: apache2}
    depool-threshold: '.74'
    description: MediaWiki thumbnail rendering cluster, rendering.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs!en.wikipedia.org!/wiki/Special:BlankPage
      sites:
        eqiad: {hostname: rendering.svc.eqiad.wmnet}
    ip: *id020
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://en.wikipedia.org/favicon.ico']
      RunCommand: {arguments: '[ ''/etc/pybal/runcommand/check-apache'', server.host
          ]', command: /bin/sh, interval: 60, timeout: 10}
    sites: [eqiad, codfw]
  restbase:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: restbase, service: restbase}
    depool-threshold: '.5'
    description: RESTBase, restbase.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_lvs_on_port!restbase.svc.%{::site}.wmnet!7231!/
      sites:
        codfw: {hostname: restbase.svc.codfw.wmnet}
        eqiad: {hostname: restbase.svc.eqiad.wmnet}
    ip: *id021
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/']
    port: 7231
    sites: [eqiad, codfw]
  search:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: elasticsearch, service: elasticsearch}
    depool-threshold: '.5'
    description: Elasticsearch search for MediaWiki
    icinga:
      check_command: check_http_on_port!9200
      sites:
        codfw: {hostname: search.svc.codfw.wmnet}
        eqiad: {hostname: search.svc.eqiad.wmnet}
    ip: *id022
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/']
    port: 9200
    sites: [eqiad, codfw]
  search-https:
    bgp: 'no'
    class: low-traffic
    conftool: {cluster: elasticsearch, service: elasticsearch-ssl}
    depool-threshold: '.5'
    description: Elasticsearch search for MediaWiki - HTTPS
    icinga:
      check_command: check_https_on_port!9243
      sites:
        codfw: {hostname: search.svc.codfw.wmnet}
        eqiad: {hostname: search.svc.eqiad.wmnet}
    ip: *id022
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['https://localhost/']
    port: 9243
    sites: [eqiad, codfw]
  swift:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: swift, service: swift-fe}
    depool-threshold: '.5'
    description: Swift/Ceph media storage
    icinga:
      check_command: check_http_lvs!ms-fe.svc.%{::site}.wmnet!/monitoring/backend
      sites:
        codfw: {hostname: ms-fe.svc.codfw.wmnet}
        eqiad: {hostname: ms-fe.svc.eqiad.wmnet}
    ip: *id023
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/monitoring/backend']
    sites: [codfw, eqiad]
  text:
    bgp: 'yes'
    class: high-traffic1
    conftool: {cluster: cache_text, service: varnish-fe}
    depool-threshold: '.5'
    description: Main wiki platform LVS service, text.%{::site}.wikimedia.org (Varnish)
    icinga:
      sites:
        codfw: {hostname: text-lb.codfw.wikimedia.org}
        eqiad: {hostname: text-lb.eqiad.wikimedia.org}
        esams: {hostname: text-lb.esams.wikimedia.org}
        ulsfo: {hostname: text-lb.ulsfo.wikimedia.org}
      uri: en.wikipedia.org!/wiki/Special:BlankPage
    ip: *id024
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  text-https:
    bgp: 'no'
    class: high-traffic1
    conftool: {cluster: cache_text, service: nginx}
    depool-threshold: '.5'
    description: Main wiki platform LVS service, text.%{::site}.wikimedia.org (nginx)
    ip: *id024
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['https://varnishcheck.wikimedia.org/from/pybal']
    port: 443
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  thumbor:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: thumbor, service: thumbor}
    depool-threshold: '.5'
    description: Thumbor image scaling
    icinga:
      check_command: check_http_lvs_on_port!thumbor.svc.%{::site}.wmnet!8800!/healthcheck
      sites:
        eqiad: {hostname: thumbor.svc.eqiad.wmnet}
    ip: *id025
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['http://localhost/healthcheck']
    port: 8800
    sites: [eqiad]
  upload:
    bgp: 'yes'
    class: high-traffic2
    conftool: {cluster: cache_upload, service: varnish-fe}
    depool-threshold: '.5'
    description: Images and other media, upload.%{::site}.wikimedia.org
    icinga:
      sites:
        codfw: {hostname: upload-lb.codfw.wikimedia.org}
        eqiad: {hostname: upload-lb.eqiad.wikimedia.org}
        esams: {hostname: upload-lb.esams.wikimedia.org}
        ulsfo: {hostname: upload-lb.ulsfo.wikimedia.org}
      uri: upload.wikimedia.org!/monitoring/backend
    ip: *id026
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  upload-https:
    bgp: 'no'
    class: high-traffic2
    conftool: {cluster: cache_upload, service: nginx}
    depool-threshold: '.5'
    description: Images and other media, upload.%{::site}.wikimedia.org
    ip: *id026
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
      ProxyFetch:
        url: ['https://varnishcheck.wikimedia.org/from/pybal']
    port: 443
    scheduler: sh
    sites: [codfw, eqiad, esams, ulsfo]
  zotero:
    bgp: 'yes'
    class: low-traffic
    conftool: {cluster: sca, service: zotero}
    depool-threshold: '.5'
    description: Zotero, zotero.svc.%{::site}.wmnet
    icinga:
      check_command: check_http_zotero_lvs_on_port!zotero.svc.%{::site}.wmnet!1969!/export?format=wikipedia
      sites:
        codfw: {hostname: zotero.svc.codfw.wmnet}
        eqiad: {hostname: zotero.svc.eqiad.wmnet}
    ip: *id027
    monitors:
      IdleConnection: {max-delay: 300, timeout-clean-reconnect: 3}
    port: 1969
    sites: [eqiad, codfw]
