profile::contacts::role_contacts: ['Infrastructure Foundations']
profile::base::production::role_description: 'Wikimedia identity management portal (staging)'
profile::idm::processes: 4

profile::puppet::agent::force_puppet7: true
# OIDC
profile::idm::oidc_service: idm_dev

# IDM options
profile::idm::service_fqdn: 'idm-test.wikimedia.org'
profile::idm::production: false
profile::idm::install_via_git: true
profile::idm::server::django_mysql_db_host: 'm5-master.eqiad.wmnet'
profile::idm::server::django_mysql_db_user: 'idm_staging'
profile::idm::server::django_mysql_db_name: 'idm_staging'

# TLS options
profile::idm::envoy_termination: true
profile::tlsproxy::envoy::upstream_addr: 127.0.0.1
profile::tlsproxy::envoy::use_remote_address: true
profile::tlsproxy::envoy::listen_ipv6: true
profile::tlsproxy::envoy::services:
  - server_names: ['idm-test.wikimedia.org']
    port: 80
profile::tlsproxy::envoy::ssl_provider: 'acme'
profile::tlsproxy::envoy::global_cert_name: idm-test
profile::tlsproxy::instance::ssl_compatibility_mode: strong
profile::tlsproxy::envoy::firewall_srange: []

# Redis
profile::idm::redis_master: 'idm-test1001'

profile::idm::enable_monitoring: false

# LDAP
profile::idm::ldap_dn: 'cn=bitu,ou=profile,dc=wikimedia,dc=org'

# MediaWiki OIDC callback
profile::idm::mediaback_callback: 'https://idm-test.wikimedia.org/complete/mediawiki'

# Account blocking setings
profile::idm::gerrit_username: 'wikitechgerritaccountbot'

# Bitu API
profile::idm::enable_api: true

profile::firewall::provider: nftables
