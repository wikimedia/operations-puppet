profile::java::java_packages:
  - version: '8'
    variant: 'jre-headless'
profile::query_service::blazegraph_main_ns: wdq
profile::query_service::package_dir: '/srv/deployment/wdqs/wdqs'
profile::query_service::data_dir: '/srv/wdqs'
profile::query_service::log_dir: '/var/log/wdqs'
profile::query_service::deploy_name: 'wdqs'
profile::query_service::endpoint: 'https://query-scholarly.wikidata.org'
profile::query_service::deploy_mode: 'scap3'
profile::query_service::enable_ldf: true
profile::query_service::high_query_time_port: true
profile::query_service::sparql_query_stream: 'wdqs-external.sparql-query'
profile::query_service::event_service_endpoint: 'https://eventgate-analytics.discovery.wmnet:4592/v1/events?hasty=true'
profile::query_service::lag_warning: 21600 # 6 hours
profile::query_service::lag_critical: 43200 # 12 hours
profile::query_service::nodes:
  - 'wdqs1023.eqiad.wmnet'
  - 'wdqs1024.eqiad.wmnet'
  - 'wdqs2023.codfw.wmnet'
  - 'wdqs2024.codfw.wmnet'
profile::admin::groups:
  - wdqs-roots
  - wdqs-admins
cluster: wdqs
contactgroups: admins,wdqs-admins
profile::lvs::realserver::pools:
  wdqs:
    services:
      - wdqs-blazegraph
      - nginx

profile::query_service::use_revisions: true
profile::tlsproxy::envoy::ssl_provider: 'cfssl'
profile::tlsproxy::envoy::cfssl_options:
  hosts:
    - wdqs-ldf.discovery.wmnet
    - wdqs-scholarly.svc.%{::site}.wmnet
    - wdqs-scholarly.wikimedia.org
    - query-scholarly.wikidata.org
profile::tlsproxy::envoy::global_cert_name: "wdqs-scholarly.discovery.wmnet"
profile::tlsproxy::envoy::listen_ipv6: true

profile::query_service::blazegraph::monitoring_enabled: true
profile::query_service::oauth: false
profile::query_service::federation_user_agent: 'Wikidata Query Service Scholarly; https://query-scholarly.wikidata.org/'

# Includes module for connection limits
profile::nginx::variant: 'full'

profile::query_service::streaming_updater::kafka_cluster: main
profile::query_service::journal: 'wikidata'

# Proxy non-blazegraph requests to the microsites
profile::query_service::gui_url: https://webserver-misc-sites.discovery.wmnet
profile::contacts::role_contacts: ['Search Platform']

# kill blazegraph when we detect 300 seconds of GC time vs 1sec*5 of runtime
# ref: https://github.com/Netflix-Skunkworks/jvmquake#knobs-and-options
profile::query_service::jvmquake_options: "300,5,0"

# Use defaults for wikidata
profile::query_service::uri_scheme_options: []

#The host for the LDF (Linked Data Fragments) endpoint
profile::query_service::ldf_host: "wdqs1015.eqiad.wmnet"

profile::puppet::agent::force_puppet7: true
acmechief_host: acmechief2002.codfw.wmnet

# User agents known to send monitoring queries
profile::query_service::monitoring_user_agents:
  - "check_http/v2.3.3 (monitoring-plugins 2.3.3)"
  - "Twisted PageGetter"
  - "prometheus-public-sparql-ep-check"
  - "wmf-prometheus/prometheus-blazegraph-exporter (root@wikimedia.org)"

profile::query_service::internal_federated_endpoints:
  "https://wdqs-main.discovery.wmnet/sparql":
    - "https://query-main.wikidata.org/sparql"
    - "https://query.wikidata.org/subgraph/wikidata_main"

profile::query_service::only_throttle_cdn: true
