profile::base::domain_search:
  - wikimedia.org
  - eqiad.wmnet
  - codfw.wmnet
cluster: misc
admin::groups:
  - deployment
  - deploy-service
  - parsoid-admin
  - wdqs-admins
  - eventlogging-admins
  - aqs-admins
  - deploy-aqs
  - deploy-phabricator
  - analytics-admins
  - gerrit-root

# screen sessions are common on deployment servers (T165348)
monitor_screens: false

# LightProcesses print an alarming error message when HHVM shuts down,
# which is often on the deployment servers, which run a bunch of scripts
# with a short runtime as part of the deployment process.
mediawiki::hhvm::extra_fcgi:
  hhvm:
    server:
      light_process_count: 0
      light_process_file_prefix: ''
mediawiki::hhvm::extra_cli:
  hhvm:
    server:
      light_process_count: 0
      light_process_file_prefix: ''
# Default scap::server configuration.  This is used in production.
# If you are setting up scap::server in labs, these will be used
# unless you override them for your labs project.
# See the overrides in hieradata/labs/deployment-prep/common.yaml
# for an example.

# keyholder::agent declarations.  These are created
# by the scap::server class.  Each agent listed here
# will be present and useable by scap on the scap deploy server.
# NOTE: since labs
scap::keyholder_agents:

  phabricator:
    trusted_groups:
      - deploy-phabricator

  gerrit:
    trusted_groups:
      - gerrit-root

  eventlogging:
    trusted_groups:
      - eventlogging-admins

  deploy-service:
    trusted_groups:
      - deploy-service
      - aqs-admins
      - deploy-aqs
      - deployment

  dumpsdeploy:
    trusted_groups:
      - ops

  analytics_deploy:
    trusted_groups:
      - analytics-admins

  deploy-librenms:
    trusted_groups:
      - ops

  deploy-puppetboard:
    trusted_groups:
      - ops

profile::kubernetes::deployment_server::git_owner: trebuchet
profile::kubernetes::deployment_server::git_group: wikidev
profile::kubernetes::deployment_server::services:
  admin:
    username: client-infrastructure
    group: root
    mode: '0400'
  mathoid:
    username: mathoid
    group: wikidev
    mode: '0640'
    namespace: mathoid

# Specified in the private repo in this form
#profile::kubernetes::deployment_server::tokens:
#  admin:
#    token: dummy
#  mathoid:
#    token: dummy
