es_codfw_rack_a2:
  __regex: !ruby/regexp /^elastic20(55|73|74|87|88)\.codfw\.wmnet$/
  profile::elasticsearch::rack: A2
  profile::elasticsearch::row:  A

es_codfw_rack_a4:
  __regex: !ruby/regexp /^elastic20(61|62|89)\.codfw\.wmnet$/
  profile::elasticsearch::rack: A4
  profile::elasticsearch::row:  A

es_codfw_rack_a7:
  __regex: !ruby/regexp /^elastic20(56|69|75|76|90|91)\.codfw\.wmnet$/
  profile::elasticsearch::rack: A7
  profile::elasticsearch::row:  A

es_codfw_rack_b2:
  __regex: !ruby/regexp /^elastic20(57|63|64|77|78|92|93|94)\.codfw\.wmnet$/
  profile::elasticsearch::rack: B2
  profile::elasticsearch::row:  B

es_codfw_rack_b4:
  __regex: !ruby/regexp /^elastic20(58|70|95|96|97)\.codfw\.wmnet$/
  profile::elasticsearch::rack: B4
  profile::elasticsearch::row:  B

es_codfw_rack_b7:
  __regex: !ruby/regexp /^elastic20(79|80)\.codfw\.wmnet$/
  profile::elasticsearch::rack: B7
  profile::elasticsearch::row:  B

es_codfw_rack_c2:
  __regex: !ruby/regexp /^elastic20(98|99)\.codfw\.wmnet$/
  profile::elasticsearch::rack: C2
  profile::elasticsearch::row:  C

es_codfw_rack_c4:
  __regex: !ruby/regexp /^elastic2(065|066|081|082|100|101)\.codfw\.wmnet$/
  profile::elasticsearch::rack: C4
  profile::elasticsearch::row:  C

es_codfw_rack_c7:
  __regex: !ruby/regexp /^elastic2(059|071|083|102|103)\.codfw\.wmnet$/
  profile::elasticsearch::rack: C7
  profile::elasticsearch::row:  C

es_codfw_rack_d2:
  __regex: !ruby/regexp /^elastic2(104|105)\.codfw\.wmnet$/
  profile::elasticsearch::rack: D2
  profile::elasticsearch::row:  D

es_codfw_rack_d4:
  __regex: !ruby/regexp /^elastic2(072|084|085|106|107)\.codfw\.wmnet$/
  profile::elasticsearch::rack: D4
  profile::elasticsearch::row:  D

es_codfw_rack_d7:
  __regex: !ruby/regexp /^elastic2(060|067|068|086|108|109)\.codfw\.wmnet$/
  profile::elasticsearch::rack: D7
  profile::elasticsearch::row:  D

es_eqiad_rack_a2:
  __regex: !ruby/regexp /^relforge1003\.eqiad\.wmnet$/
  profile::elasticsearch::rack: A2
  profile::elasticsearch::row:  A

es_eqiad_rack_a3:
  __regex: !ruby/regexp /^elastic1054\.eqiad\.wmnet$/
  profile::elasticsearch::rack: A3
  profile::elasticsearch::row:  A

es_eqiad_rack_a4:
  __regex: !ruby/regexp /^elastic10(68|69|84)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: A4
  profile::elasticsearch::row:  A

es_eqiad_rack_a5:
  __regex: !ruby/regexp /^elastic1053\.eqiad\.wmnet$/
  profile::elasticsearch::rack: A5
  profile::elasticsearch::row:  A

es_eqiad_rack_a7:
  __regex: !ruby/regexp /^elastic10(70|71|72|73)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: A7
  profile::elasticsearch::row:  A

es_eqiad_rack_b1:
  __regex: !ruby/regexp /^elastic1055\.eqiad\.wmnet$/
  profile::elasticsearch::rack: B1
  profile::elasticsearch::row:  B

es_eqiad_rack_b2:
  __regex: !ruby/regexp /^(relforge1004|elastic1074|elastic1075)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: B2
  profile::elasticsearch::row:  B

es_eqiad_rack_b4:
  __regex: !ruby/regexp /^elastic10(76|77|78|79)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: B4
  profile::elasticsearch::row:  B

es_eqiad_rack_b5:
  __regex: !ruby/regexp /^elastic1056\.eqiad\.wmnet$/
  profile::elasticsearch::rack: B5
  profile::elasticsearch::row:  B

es_eqiad_rack_b7:
  __regex: !ruby/regexp /^elastic10(85|86)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: B7
  profile::elasticsearch::row:  B

es_eqiad_rack_c3:
  __regex: !ruby/regexp /^elastic10(57|58)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: C3
  profile::elasticsearch::row:  C

es_eqiad_rack_c4:
  __regex: !ruby/regexp /^elastic10(80|81)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: C4
  profile::elasticsearch::row:  C

es_eqiad_rack_c7:
  __regex: !ruby/regexp /^elastic10(82|83|87|88)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: C7
  profile::elasticsearch::row:  C

es_eqiad_rack_c8:
  __regex: !ruby/regexp /^elastic1059\.eqiad\.wmnet$/
  profile::elasticsearch::rack: C8
  profile::elasticsearch::row:  C

es_eqiad_rack_d1:
  __regex: !ruby/regexp /^elastic10(60|61)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: D1
  profile::elasticsearch::row:  D

es_eqiad_rack_d3:
  __regex: !ruby/regexp /^elastic10(62|63)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: D3
  profile::elasticsearch::row:  D

es_eqiad_rack_d4:
  __regex: !ruby/regexp /^elastic1(064|103)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: D4
  profile::elasticsearch::row:  D

es_eqiad_rack_d5:
  __regex: !ruby/regexp /^elastic1065\.eqiad\.wmnet$/
  profile::elasticsearch::rack: D5
  profile::elasticsearch::row:  D

es_eqiad_rack_d6:
  __regex: !ruby/regexp /^elastic10(66|67)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: D6
  profile::elasticsearch::row:  D

es_eqiad_rack_e1:
  __regex: !ruby/regexp /^elastic1(089|090|104)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: E1
  profile::elasticsearch::row:  E

es_eqiad_rack_e2:
  __regex: !ruby/regexp /^elastic10(91|92)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: E2
  profile::elasticsearch::row:  E

es_eqiad_rack_e3:
  __regex: !ruby/regexp /^elastic10(93|94|95)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: E3
  profile::elasticsearch::row:  E

es_eqiad_rack_e5:
  __regex: !ruby/regexp /^elastic1105\.eqiad\.wmnet$/
  profile::elasticsearch::rack: E5
  profile::elasticsearch::row:  E

es_eqiad_rack_f1:
  __regex: !ruby/regexp /^elastic1(096|097|106)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: F1
  profile::elasticsearch::row:  F

es_eqiad_rack_f2:
  __regex: !ruby/regexp /^elastic10(98|99)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: F2
  profile::elasticsearch::row:  F

es_eqiad_rack_f3:
  __regex: !ruby/regexp /^elastic11(00|01|02)\.eqiad\.wmnet$/
  profile::elasticsearch::rack: F3
  profile::elasticsearch::row:  F

es_eqiad_rack_f5:
  __regex: !ruby/regexp /^elastic1107\.eqiad\.wmnet$/
  profile::elasticsearch::rack: F5
  profile::elasticsearch::row:  F

# T204361
es_eqiad_500G_disk:
  __regex: !ruby/regexp /^(elastic101[7-9]|elastic1020|elastic102[2-9]|elastic103[0-1])\.eqiad\.wmnet$/
  profile::monitoring::nrpe_check_disk_options: -w 10% -c 5% -W 6% -K 3% -l -e -A -i "/srv/sd[a-b][1-3]" --exclude-type=tracefs

mysql_eqiad:
  __regex: !ruby/regexp /^(db1[01][0-9][0-9]|dbstore100[7-9]|dbproxy10[01][0-9]|es10[0-9][0-9]|pc10[0-9][0-9]|clouddb10[012][0-9]|an-redacteddb1001)\.eqiad\.wmnet$/
  cluster: mysql

mysql_codfw:
  __regex: !ruby/regexp /^(db2[01][0-9][0-9]|dbproxy200[1-8]|es200[1-4]|pc20[0-9][0-9]|es20[0-9][0-9])\.codfw\.wmnet$/
  cluster: mysql

db_eqiad:
  __regex: !ruby/regexp /^(db1[01][0-9][0-9])\.eqiad\.wmnet$/

dbproxy_eqiad:
  __regex: !ruby/regexp /^(dbproxy10[01][0-9])\.eqiad\.wmnet$/

dbproxy_codfw:
  __regex: !ruby/regexp /^(dbproxy200[1-8])\.codfw\.wmnet$/

extstorage_eqiad:
  __regex: !ruby/regexp /^(es101[1-9])\.eqiad\.wmnet$/

# Cephadm cluster selection
apus_eqiad:
  __regex: !ruby/regexp /^(moss|apus)-(be|fe)1[0-9]+\.eqiad\./
  profile::cephadm::cluster_label: apus
  cluster: apus

apus_codfw:
  __regex: !ruby/regexp /^(moss|apus)-(be|fe)2[0-9]+\.codfw\./
  profile::cephadm::cluster_label: apus
  cluster: apus

# Legacy hosts with a single object-server per port
# https://phabricator.wikimedia.org/T222366
swift_servers_per_port:
  __regex: !ruby/regexp /^ms-be(10([1-4][0-9]|50)|20[1-4][0-9])\.(codfw|eqiad)\.wmnet$/
  profile::swift::storage::servers_per_port: 0

# Hosts with 24x HDD https://phabricator.wikimedia.org/T252216
swift_24_drives:
  __regex: !ruby/regexp /^ms-be(205[7-9]|20[6-9][0-9]|10[6-9][0-9])\.(codfw|eqiad)\.wmnet$/
  swift_storage_drives:
    - '/dev/sdc'
    - '/dev/sdd'
    - '/dev/sde'
    - '/dev/sdf'
    - '/dev/sdg'
    - '/dev/sdh'
    - '/dev/sdi'
    - '/dev/sdj'
    - '/dev/sdk'
    - '/dev/sdl'
    - '/dev/sdm'
    - '/dev/sdn'
    - '/dev/sdo'
    - '/dev/sdp'
    - '/dev/sdq'
    - '/dev/sdr'
    - '/dev/sds'
    - '/dev/sdt'
    - '/dev/sdu'
    - '/dev/sdv'
    - '/dev/sdw'
    - '/dev/sdx'
    - '/dev/sdy'
    - '/dev/sdz'

# hosts using the new storage schema (JBOD not RAID) cf T308677
swift_new_storage:
  __regex: !ruby/regexp /^ms-be(107[2-9]|10[8-9][0-9]|2050|20[7-9][0-9])\.(codfw|eqiad)\.wmnet$/
  profile::swift::storage::disks_by_path: true
thanos_new_storage:
  __regex: !ruby/regexp /^thanos-be(1005|2005)\.(codfw|eqiad)\.wmnet$/

# require WriteBack policy to all hosts (independent of the role) that look
# like databases. Currently this only works for megacli systems, but it will
# be applied to HP RAIDs when available. Systems where this is not currently
# compatible are ignored and do not send any alert.
db_like_raid_policy:
  __regex: !ruby/regexp /^(db|dbstore|es|pc|clouddb)[12]\d\d\d\.(eqiad|codfw)\.wmnet$/
  profile::monitoring::raid_write_cache_policy: 'WriteBack'

mediawiki_test_environment:
  __regex: !ruby/regexp /^mwdebug(1[0-9]+\.eqiad|2[0-9]+\.codfw)\.wmnet$/
  profile::base::environment: mediawiki_test
  profile::mediawiki::apc_shm_size: 128M
  profile::mediawiki::php::fpm_config:
    opcache.interned_strings_buffer: 50
    opcache.memory_consumption: 300
  profile::mediawiki::php::restarts::opcache_limit: 100
  profile::mediawiki::php::enable_request_profiling: true
  profile::mediawiki::php::phpdbg: true
  profile::mediawiki::php::absented_php_versions:
    - "7.2"

# These two Hadoop workers have GPU cards present.
hadoop_gpu_workers:
  __regex: !ruby/regexp /^an-worker(110[0-1])\.eqiad\.wmnet$/
  profile::amd_gpu::rocm_version: '54'

# These six hosts are different from the other Hadoop workers in that they
# have 24 x 2.5" data drives, as opposed to 12 x 3.5" drives.
hadoop_workers_sff_drives:
  __regex: !ruby/regexp /^an-worker(109[6-9]|110[0-1])\.eqiad\.wmnet$/
  profile::hadoop::common::min_datanode_mounts: 20

# Extstore experiment T352885 (eqiad only)
memcached_servers_extstore_eqiad:
  __regex: !ruby/regexp /^mc10(3[7-9]|4[0-9]|5[0-4])\.eqiad\.wmnet$/
  profile::memcached::memcached_user: 'memcache'
  profile::memcached::threads: 28
  profile::memcached::extstore_ensure: present
  profile::memcached::extstore_size: 50
  profile::memcached::extstore_path: /srv/memcached
  profile::memcached::extended_options:
    - "modern"
    - "ext_item_size=176"
    - "ext_threads=2"
